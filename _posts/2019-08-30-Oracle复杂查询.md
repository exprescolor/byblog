---
layout:     post 
title:      Oracle复杂查询
subtitle:   复杂查询关键字
date:       2019-08-30
author:     张鹏
header-img: img/post-bg-debug.png
catalog: true   
tags:                              
    - Oracle
---

# Oracle复杂查询
------
### 组合查询

- `UNION、UNION ALL、_INTERSECT、MINUS`
   - `UNION`可以完成将两个以上的表的相类似的查询结果合并在一起，并且相同的只取其一
   `SELECT emp_no,emp_name from emp1 UNION SELECT emp_no,emp_name from emp2;`
   - `UNION ALL`也可以完成将两个以上的表的相类似的查询结果合并在一起，如果有相同记录，不会去掉相同记录
   `SELECT emp_no,emp_name from emp1 UNION ALL SELECT emp_no,emp_name from emp2;`
   - `_INTERSECT`:返回在两个查询结果中都有相同内容的信息
   `SELECT emp_no,emp_name from emp1 INTERSECT SELECT emp_no,emp_name from emp2;`
   - `MINUS`：返回只在一个查询中出现的信息
   `SELECT emp_no,emp_name from emp1 MINUS SELECT emp_no,emp_name from emp2;`
   
------

- `DECODE`
   - 在逻辑编程中，经常用到If-Then-Else进行逻辑判断。在DECODE的语法中，实际上就是这样的逻辑处理过程。语法如下：
   `DECODE(value,if1,then1,if2,then2,if3,then3,...,else)`
   - `value`代表某个表的任何类型的任意列或一个通过得到的任何结果。当每一个value值被测试，如果value的值为if1，DECODE函数的结果就是then1；如果value的值等于if2，DECODE函数的结果就是then2；事实上，可以给出多个if/then配对。如果value结果不等于给出的任何配对时，DECODE结果就返回else。
   - 需要注意的是，这里的if、then、else都可以是函数或计算表达式
   - 例：
   `SELECT emp_no,emp_name,decode(emp_type,'01','正式员工','02','派遣员工','03','外包员工','其他员工')emp_type from emp;`
   
------

- 递归查询（树查询）
   - 基本语法：
   ```plsql
   select ... from tablename where 条件1
   start with 条件2
   connect by prior 条件3;
   ```
   - 其中：
   - 条件1是过滤条件，用于对返回的所有记录进行过滤
   - 条件2是根节点的限定语句，当然也可以放宽限定条件，以取得多个根节点，实际就是多棵树
   - 条件3是连接条件，其中用PRIOR表示上一条记录，比如:
   ```plsql
   connect by prior org_id=parent_id
   ```
   就是说上一条记录的org_id是本条记录的parent_id,即本条记录的父亲是上一条记录
   - 例：从DM_SWJG中查询根节点为‘0000000000’的所有区县级税务机关代码和名称（从根节点开始遍历所有下级）
   ```plsql
   select swjg_dm,swjg_mc where jgjc_dm='05' start with swjg_dm='0000000000' connect by prior swjg_dm=sj_swjg_dm
   ```

