---
layout:     post                    # 使用的布局（不需要改）
title:      MyBatis-Plus学习笔记 2          # 标题 
subtitle:   快速入门             #副标题
date:       2019-10-18              # 时间
author:     AhogeK                      # 作者
header-img: img/mybatis_plus.png   #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - java
    - MyBatis-Plus
    - 学习笔记
---

> 这依旧是一个简单的快速开始的Demo笔记,参照MP官方文档的快速开始

### 初始化工程
创建一个空的Spring Boot 工程（本工程会以 H2 作为默认数据库进行演示）
>可以使用[Spring Initalizer](https://start.spring.io/)快速生成一个 Spring Boot 工程。同是也可以直接在IDE上进行创建，Eclipse需要安装 Spring Tool 插件

### 添加依赖
创建完的工程默认包含``spring-boot-starter-parent`` ``spring-boot-starter``等一部分dependency 最终pom文件如下

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>2.2.0.RELEASE</version>
		<relativePath /> <!-- lookup parent from repository -->
	</parent>
	<groupId>com.example</groupId>
	<artifactId>demo</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<name>demo</name>
	<description>Demo project for Spring Boot</description>

	<properties>
		<java.version>1.8</java.version>
	</properties>

	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>org.projectlombok</groupId>
			<artifactId>lombok</artifactId>
			<optional>true</optional>
		</dependency>
		<dependency>
			<groupId>com.baomidou</groupId>
			<artifactId>mybatis-plus-boot-starter</artifactId>
			<version>3.2.0</version>
		</dependency>
		<dependency>
			<groupId>com.h2database</groupId>
			<artifactId>h2</artifactId>
			<scope>runtime</scope>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
			</plugin>
		</plugins>
	</build>

</project>

```

### 配置
自动生成的项目中，有一个``application.properties``配置文件，这里我将 *properties* 修改成 *yml* 都是配置文件，只是格式不同，按个人操作习惯

```yml
# DataSource Config
spring: 
  datasource:
    driver-class-name: org.h2.Driver
    schema: classpath:db/schema-h2.sql
    data: classpath:db/data-h2.sql
    url: jdbc:h2:mem:test;DB_CLOSE_DELAY=-1
    username: root
    password: 0000
```

这里使用了H2用来测试。  *H2是一个开源的、纯Java实现的关系数据库。*

* driver-class-name: *H2驱动程序*
* url: *这里使用了内存模式，数据库只在内存中运行，关闭链接后数据库会被清空，适合测试环境*

**当中会看到schema和data的配置，这个等下需要在release中创建一个db文件夹放入一个建表一个插入数据的SQL文件**

* schema-h2.sql

```sql
DROP TABLE IF EXISTS user;

CREATE TABLE user
(
	id BIGINT(20) NOT NULL COMMENT '主键ID',
	name VARCHAR(30) NULL DEFAULT NULL COMMENT '姓名',
	age INT(11) NULL DEFAULT NULL COMMENT '年龄',
	email VARCHAR(50) NULL DEFAULT NULL COMMENT '邮箱',
	PRIMARY KEY (id)
);
```

* data-h2.sql

```sql
DELETE FROM user;

INSERT INTO user (id, name, age, email) VALUES
(1, 'Jone', 18, 'test1@baomidou.com'),
(2, 'Jack', 20, 'test2@baomidou.com'),
(3, 'Tom', 28, 'test3@baomidou.com'),
(4, 'Sandy', 21, 'test4@baomidou.com'),
(5, 'Billie', 24, 'test5@baomidou.com');
```

随后在初始化自动生成的 Application 启动类所在的包下新建一个Mapper包，并在启动类中添加包扫描

```java
package com.example.demo;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
@MapperScan("com.example.demo.mapper")
public class DemoApplication {

	public static void main(String[] args) {
		SpringApplication.run(DemoApplication.class, args);
	}

}
```
*当中添加@MapperScan的注解扫描mapper包*

### 编码
同再新创建一个实体包（entity）并在其中新建一个实体类 ``User.java`` (此处使用了 ``Lombok`` 简化代码)

```java
package com.example.demo.entity;

import lombok.Data;

@Data
public class User {
	private Long id;
  private String name;
  private Integer age;
  private String email;
}
```
再编写Mapper类 在Mapper包中创建 ``UserMapper.java`` 接口

```java
public interface UserMapper extends BaseMapper<User> {

}
```
*这里不需要编写任何代码，只需继承 BaseMapper 并将 User 实体类作为泛型参数，它默认会提供我们一系列的怎删改查的基础方法*

### 开始使用
添加测试类，进行功能测试：

```java
package com.example.demo;

import java.util.List;

import org.junit.jupiter.api.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import com.example.demo.entity.User;
import com.example.demo.mapper.UserMapper;

import junit.framework.Assert;

@RunWith(SpringRunner.class)
@SpringBootTest
class DemoApplicationTests {

	@Autowired
	private UserMapper userMapper;
	
	@Test
	void contextLoads() {
		System.out.println("---- SelectAll method test ----");
		List<User> userList = userMapper.selectList(null);
		Assert.assertEquals(5, userList.size());
        userList.forEach(System.out::println);
	}

}
```
*Assert是一个断言类，但其实现在用不到了，报废的方法*

>UserMapper 中的 ``selectList()`` 方法的参数为 MP 内置的条件封装器 ``Wrapper``，所以不填写就是无任何条件

控制台会输出：

```console
—— SelectAll method test ——
User(id=1, name=Jone, age=18, email=test1@baomidou.com)
User(id=2, name=Jack, age=20, email=test2@baomidou.com)
User(id=3, name=Tom, age=28, email=test3@baomidou.com)
User(id=4, name=Sandy, age=21, email=test4@baomidou.com)
User(id=5, name=Billie, age=24, email=test5@baomidou.com)
```