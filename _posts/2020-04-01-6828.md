---
layout:     post   				    # 使用的布局（不需要改）
title:      828-lab2-part1		# 标题 
#subtitle:   脚本，xss #副标题
date:       2020-04-01 				# 时间
author:     s-seven 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 6828
---

#Lab2:内存管理

在这个实验中，我们将为操作系统编写内存管理代码。内存管理有两个组件。
第一个组件是内核的物理内存分配器，以便内核可以分配内存并在以后释放它。分配器将以4096字节为单位进行操作，称为页。我们需要维护数据结构，记录哪些物理页面是空闲的，哪些是已分配的，以及有多少进程共享每个已分配的页面。还需要编写分配和释放内存页的例程。
内存管理的第二个组成部分是虚拟内存，它将内核和用户软件使用的虚拟地址映射到物理内存中的地址。x86硬件的内存管理单元(MMU)在指令使用内存时执行映射，参考一组页表。我们要根据提供的规范修改JOS以设置MMU的页表。

Lab 2包含以下新的源文件:

- inc/memlayout.h
- kern/pmap.c
- kern/pmap.h
- kern/kclock.h
- kern/kclock.c

memlayout.h描述了虚拟地址空间的结构，我们需要通过修改pmap.c文件来实现这个结构。memlayout.h和pmap.h文件定义了一个PageInfo结构，利用这个结构可以记录有哪些物理页是空闲的。kclock.c和kclock.h文件中操作的是用电池充电的时钟，以及CMOS RAM设备。在这个设备中记录着PC机拥有的物理内存的数量。在pmap.c中的代码必须读取这个设备中的信息才能弄清楚到底有多少内存。

##Part 1：物理页管理

操作系统必须跟踪哪些物理RAM是空闲的，哪些是当前正在使用的。JOS以页面粒度管理PC的物理内存，这样它就可以使用MMU来映射和保护每一块分配的内存。

现在，我们要编写物理页面分配器。它通过struct PageInfo对象的链接列表(与xv6不同，这些对象没有嵌入到空闲页面本身中)跟踪哪些页面是空闲的，每个对象对应一个物理页面。在编写其余的虚拟内存实现之前，我们要先编写物理页分配程序，因为页表管理代码将需要分配物理内存来存储页表。
