---
layout:     post   				    # 使用的布局（不需要改）
title:      828-lab1-part1-环境配置		# 标题 
#subtitle:   脚本，xss #副标题
date:       2020-03-24 				# 时间
author:     s-seven 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 基础知识
---

今天打开了第三阶段的一个实验，是2018年MIT 6.828 JOS内核实验，去官网转了一圈，一脸懵逼。

官网大概说了一下需要的工具，项目的课程表、代码，和一些这门课的学习资料，那就从环境的配置开始吧。

# 平台工具

> https://pdos.csail.mit.edu/6.828/2018/tools.html  (平台搭建的指导页面)

## 测试编译器工具链

“编译器工具链”是一组程序，包括C编译器、汇编器和链接器，它们将代码转换成可执行的二进制文件。我们需要需要一个为ELF二进制格式的32位Intel体系结构(“x86”体系结构)生成代码的编译器工具链。

两句代码来测试我们的Linux环境

`objdump -i`

`gcc -m32 -print-libgcc-file-name`

![image-20200324155459331.png](http://ww1.sinaimg.cn/large/005KQQDely1gd5dzj5yqyj30fx04caam.jpg)



![image-20200324155622078.png](http://ww1.sinaimg.cn/large/005KQQDely1gd5dzzq2kdj30ln01e74d.jpg)



如果这两个命令都执行成功的话，进入到下一步

**大端序和小端序**

即字节的存储顺序，如果数据都是单字节的，那怎么存储无所谓了，但是对于多字节数据，比如int，double等，就要考虑存储的顺序了。注意字节序是硬件层面的东西，对于软件来说通常是透明的。再说白一点，字节序通常只和你使用的处理器架构有关，而和编程语言无关，比如常见的Intel x86系列就是小端序。

大端序即数据的高位字节存放在地址的低端 低位字节存放在地址高端。

小端序即数据的高位字节存放在地址的高端 低位字节存放在地址低端。

举例：

var = 0x11223344，对于这个变量的最高字节为0x11，最低字节为0x44

大端模式存储（存储地址为16位）

地址                    数据

0x0004(高地址)     0x44

0x0003                 0x33

0x0002                 0x22

0x0001(低地址)     0x11

小端模式存储（存储地址为16位）

地址                    数据

0x0004(高地址)     0x11

0x0003                 0x22

0x0002                 0x33

0x0001(低地址)     0x44

# qemu安装

QEMU是一个现代和快速的PC仿真器。

首先下载qemu：

`git clone https://github.com/mit-pdos/6.828-qemu.git qemu	`

![image-20200324164845285.png](http://ww1.sinaimg.cn/large/005KQQDely1gd5e0ceny2j30ol02z74v.jpg)

这个还挺快的，几分钟就下下来了

进入qemu目录下：

`cd qemu`

然后输入命令：

`./configure`

这一步看似简单，我报错到崩溃，首先遇到了这个错误：

![image-20200324175439222.png](http://ww1.sinaimg.cn/large/005KQQDely1gd5e0jmko2j30gu03ddg7.jpg)

本着少什么就加什么的原则，我一共添加了：

```
sudo apt-get install pkg-config
sudo apt-get install libfdt
sudo apt-get install libfdt
sudo apt-get install libfdt-dev
```

最后成功之后显示一些配置信息

我们执行一下make指令：

![image-20200324175601810.png](http://ww1.sinaimg.cn/large/005KQQDely1gd5e0rmeb3j30gy049dgf.jpg)



哦呵呵呵我又开始报错了，下面这个错误是缺少了一个头文件

![image-20200324175628785.png](http://ww1.sinaimg.cn/large/005KQQDely1gd5e0yfz99j30oj0ddtai.jpg)

解决方法：
在 qga/commands-posix.c文件中加 #include <sys/sysmacros.h>

然后继续执行make，出现：

![image-20200324175648936.png](http://ww1.sinaimg.cn/large/005KQQDely1gd5e14q7x4j30oq0ag0v4.jpg)

解决方法：config-host.mak文件中的-Werror去掉

继续make：

![image-20200324175725048.png](http://ww1.sinaimg.cn/large/005KQQDely1gd5e1azogtj30d60343ys.jpg)

以上是make执行完后最后几条信息，我们再执行最后一步

`make install`

![image-20200324175757923.png](http://ww1.sinaimg.cn/large/005KQQDely1gd5e1iluofj30hk02zgm2.jpg)

这一步没出现什么问题

Git一下源码,这一步将源码放在lab目录下

`git clone https://pdos.csail.mit.edu/6.828/2018/jos.git lab`

make一下，出现一下错误，解决方法是安装gcc-multilib

![image-20200324180712673.png](http://ww1.sinaimg.cn/large/005KQQDely1gd5e1o5ucgj30lt04z0tz.jpg)

最后一步make qemu

![image-20200324180811406.png](http://ww1.sinaimg.cn/large/005KQQDely1gd5e1toj60j30or0cudi0.jpg)

出现这个样子就安装成功啦

bug体质的我每逢安装必报错，好在每个error都能在网上找到解决方案，最后也算是把环境配好了。明天开始学习这个项目，根据网站给出的汇编参考资料，操作系统参考书和上课的算是课件吧，一步一步来，总会好的。
