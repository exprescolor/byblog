---
layout:     post 
title:      Java基础0905
subtitle:   多线程
date:       2019-09-05
author:     张鹏
header-img: img/post-bg-debug.png
catalog: true   
tags:                         
    - Java
---

# Java基础

## Java多线程机制

### 线程的基本概念

- 线程是一个程序内部的顺序控制流
- Java中的线程是通过java.lang.Thread类来实现的
- VM启动时会有一个由主方法所定义的线程（public static void main(){}）
- 可以通过创建Thread的实例来创建新的线程
- 每个线程都是通过某个特定的Thread对象所对应的方法run()来完成其操作的，方法run()称为线程体
- 通过调用Thread类的start()方法来启动一个线程

### 线程和进程的区别

- 每一个进程都有独立的代码和数据空间（进程上下文），进程间的切换会有较大的开销
- 线程可以看成是轻量级的进程，同一类线程共享代码和数据空间，每个线程有独立的运行栈和程序计数器（PC），线程切换的开销小
- 多进程：在操作系统中能同时运行多个程序（任务）
- 多线程：在同一应用程序中有多个顺序流同时执行

### 线程的创建和启动

- 有两种的方式创建新的线程

#### 第一种

- 定义线程类实现Runnable接口
   - `Thread myThread=new Thread(target);`//target为Runnable接口类型
   - Runnable中只有一个方法
      - `public void run();`用于定义线程运行体
   - 使用Runnable接口可以为多个线程提供共享的数据
   - 在实现Runnable接口的类的run方法定义中可以使用Thread的静态方法
      - `public static Thread currentThread();`获取当前线程的引用

- 例子：

```java
public class TestThread{
    public static void main(String args[]){
        Runner1 r=new Runner1();
        //r.run();
        Thread t=new Thread(r);
        t.start();
        for(int i=0;i<100;i++){
            System.out.println("Main Thread:======="+i);
        }
    }
}
    class Runner1 implements Runnable{
        public void run(){
            for(int i=0;i<100;i++){
                System.out.println("Runner1:"+i);
            }
        }
    }
```

#### 第二种

- 定义一个Thread的子类并重写其run方法：

```java
class MyThread extends Thread{
       public void run(){......}
   }
```
- 然后生成该类的对象

```java
MyThread myThread=new MyThread(......)
```
- 例子：

```java
public class TestThread{
    public static void main(String args[]){
        Runner1 r=new Runner1();
        r.start();
        for(int i=0;i<100;i++){
            System.out.println("Main Thread:======="+i);
        }
    }
}
    class Runner1 extends Thread{
        public void run(){
            for(int i=0;i<100;i++){
                System.out.println("Runner1:"+i);
            }
        }
    }
```
### 线程的状态转换

![线程的状态转换](https://github.com/Jokerboozp/Jokerboozp.github.io/raw/master/img/%E6%89%B9%E6%B3%A8%202019-09-05%20093911.png)

### 线程控制的基本方法
| 方法                 | 功能                                                         |
| -------------------- | ------------------------------------------------------------ |
| isAlive()            | 判断线程是否还“活”着，即线程是否还未终止（阻塞，运行，就绪都叫“活着”） |
| getPriority()        | 获得线程的优先级数值                                         |
| setPriority()        | 设置线程的优先级数值                                         |
| Thread.sleep()       | 将当前线程睡眠指定毫秒数                                     |
| join()               | 调用某线程的该方法，将当前线程与该线程“合并”，即等待该线程结束，再恢复当前线程的运行 |
| yield()              | 让出CPU，当前线程进入就绪队列等待调度                        |
| wait()               | 当前线程进入对象的wait pool                                  |
| notify()/notifyAll() | 唤醒对象的wait pool中的一个/所有等待线程                     |

### sleep、join、yield方法

#### sleep方法

- 可以调用Thread的静态方法

```java
public static void sleep(long millis) throws InterruptedException
//使得当前线程休眠（暂时停止执行millis毫秒）
```
- 由于是静态方法，sleep可以由类名直接调用

```java
Thread.sleep(...)
```
- 例子：

```java
import java.util.*;
public class TestInterrupt{
    public static void main(String[] args){
        MyThread thread=new MyThread();
        thread.start();
        try{Thread.sleep(10000);}
		catch(InterruptedException e){}
            thread.interrupt();
    }
}
class MyThread extends Thread{
    public void run(){
        while(true){
            System.out.println("===="+new Date()+"====");
            try{
                sleep(1000);
            }catch(InterruptedException e){
                return;
            }
        }
    }
}
```

#### join方法

- 合并某个线程
- 例子：

```java
import java.util.*;
public class TestJoin{
    public static void main(String[] args){
        MyThread t1=new MyThread("t1");
        t1.start();
        try{
            t1.join();
        }catch(InterruptedException e){}
        for(int i=1;i<=10;i++){
            System.out.println("i am main thread");
        }
    }
}
class MyThread extends Thread{
    MyThread(String s){
        super(s);
    }
    public void run(){
        for(int i=1;i<=10;i++){
            System.out.println("i am "+getName());
            try{sleep(1000);}
            catch(InterruptedException e){
                return;
            }
        }
    }
}
```

#### yield方法

- 让出CPU，给其他线程执行的机会
- 例子：

```java
public class TestYield{
    public static void main(String[] args){
        MyThread t1=new MyThread("t1");
        MyThread t2=new MyThread("t2");
        t1.start();
        t2.start();
    }
}
class MyThread extends Thread{
    MyThread(String s){super(s);}
    public void run(){
        for(int i=1;i<=100;i++){
            System.out.println(getName()+":"+i);
            if(i%10==0){
                yield();
            }
        }
    }
}
```