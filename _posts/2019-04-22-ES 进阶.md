---
layout:     post
title:      Elasticsearch进阶
subtitle:   
author:     大暴马
catalog: 	 true
tags:
    - ES
    - 开发
---
### 分布式特性
Elasticsearch 尽可能地屏蔽了分布式系统的复杂性。这里列举了一些在后台自动执行的操作：

1. 分配文档到不同的容器 或 分片 中，文档可以储存在一个或多个节点中
2. 按集群节点来均衡分配这些分片，从而对索引和搜索过程进行负载均衡
3. 复制每个分片以支持数据冗余，从而防止硬件故障导致的数据丢失
4. 将集群中任一节点的请求路由到存有相关数据的节点
5. 集群扩容时无缝整合新节点，重新分配分片以便从离群节点恢复

了解ES分布式特性，需要知道
1. 集群扩容、
2. 故障转移(集群内的原理)
3. 分布式文档存储
4. 执行分布式搜索
5. 分区（shard）及其工作原理(分片内部原理) 。

### 集群扩容
#### 集群概念
一个运行中的 Elasticsearch 实例称为一个 节点，而集群是由一个或者多个拥有相同 cluster.name 配置的节点组成， 它们共同承担数据和负载的压力。当有节点加入集群中或者从集群中移除节点时，集群将会重新平均分布所有的数据。
当一个节点被选举成为 主 节点时， 它将负责管理集群范围内的所有变更，例如增加、删除索引，或者增加、删除节点等。 而主节点并不需要涉及到文档级别的变更和搜索等操作，所以当集群只拥有一个主节点的情况下，即使流量的增加它也不会成为瓶颈。 任何节点都可以成为主节点。
我们可以将请求发送到 集群中的任何节点 ，包括主节点。 每个节点都知道任意文档所处的位置，并且能够将我们的请求直接转发到存储我们所需文档的节点。 无论我们将请求发送到哪个节点，它都能负责从各个包含我们所需文档的节点收集回数据，并将最终结果返回給客户端。 Elasticsearch 对这一切的管理都是透明的。
#### 集群健康
Elasticsearch 的集群监控信息中包含了许多的统计数据，其中最为重要的一项就是 集群健康 ， 它在 status 字段中展示为 green 、 yellow 或者 red 。
```
GET /_cluster/health
```
```
{
   "cluster_name":          "elasticsearch",
   "status":                "green", 
   "timed_out":             false,
   "number_of_nodes":       1,
   "number_of_data_nodes":  1,
   "active_primary_shards": 0,
   "active_shards":         0,
   "relocating_shards":     0,
   "initializing_shards":   0,
   "unassigned_shards":     0
}
```
status 字段是我们最关心的,指示着当前集群在总体上是否工作正常。它的三种颜色含义如下：

颜色|状态
----|----
green|所有的主分片和副本分片都正常运行。
yellow|所有的主分片都正常运行，但不是所有的副本分片都正常运行。
red|有主分片没能正常运行。

to be continue:
https://elasticsearch.cn/book/elasticsearch_definitive_guide_2.x/_add-an-index.html

### 故障转移
故障时确保数据安全




### 微信扫一下，最新最全最好看的电影都有，谢谢了~
 ![](https://open.weixin.qq.com/qr/code?username=zhihuishangye)