---
layout:     post   				    # 使用的布局（不需要改）
title:      C++内存管理与分配相关知识点总结				# 标题 
subtitle:   八股的一部分 #副标题
date:       2022-04-08 				# 时间
author:     谢玄xx 						# 作者
header-img: img/bit (4).jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 内存分配
    - 八股
---

c++的指针：先在栈中存指针a，再向堆中申请内存空间存该指针所指向的元素，然后a指向该地址。

参考链接： [C/C++内存分配管理](https://blog.csdn.net/u010183728/article/details/81629706)

# 内存概述

在C++中内存分为5个区，分别是**堆**、**栈**、**自由存储区**、**全局/静态存储区**和**常量存储区**。

堆：堆是操作系统中的术语，是操作系统所维护的一块特殊内存，用于程序的内存动态分配，C语言使用malloc从堆上分配内存，使用free释放已分配的对应内存。

栈：在执行函数时，函数内局部变量的存储单元都可以在栈上创建，函数执行结束时这些存储单元自动被释放。栈内存分配运算内置于处理器的指令集中，效率很高，但是分配的内存容量有限。

自由存储区：自由存储区是C++基于new操作符的一个抽象概念，凡是通过new操作符进行内存申请，该内存即为自由存储区。

全局/静态存储区：这块内存是在程序编译的时候就已经分配好的，在程序整个运行期间都存在。例如全局变量，静态变量。

常量存储区：这是一块比较特殊的存储区，他们里面存放的是常量(const)，不允许修改。

# 常见的内存错误及解决方法

1. 内存分配未成功，却使用了它。

   解决方法：在使用内存之前检查指针是否为NULL。如果指针p是函数的参数，那么在函数的入口处用assert(p!=NULL)进行检查。如果是用malloc来申请内存，应该用if(p==NULL) 或if(p!=NULL)进行防错处理。如果是用new来申请内存，申请失败是会抛出异常，所以应该捕捉异常来进行放错处理。(感谢@ melonstreet指出)。

2. 内存分配虽然成功，但是尚未初始化就引用它。

   解决方法：尽管有时候缺省时会自动初始化，但是无论创建什么对象均要对其进行初始化，即便是赋零值也不可省略，不要嫌麻烦。

3. 内存分配成功，但越界访问。

　 解决方法：对数组for循环时要把握边界，否则可能会导致数组越界。

4. 忘记了释放内存，导致内存泄漏。

　 解决方法：动态内存的申请和释放必须配对，new-delete和malloc-free且使用次数必须相同。



