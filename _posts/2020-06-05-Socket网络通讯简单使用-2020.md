---
layout:     post                        # 使用的布局（不需要改）
title:      Socket网络通讯简单使用               # 标题
subtitle:     # 副标题
date:       2020-06-05                  # 时间
author:     AhogeK                      # 作者
header-img:  https://external-content.duckduckgo.com/iu/?u=http%3A%2F%2Fi.stack.imgur.com%2FEdv8s.jpg&f=1&nofb=1    # 这篇文章标题背景图片
catalog: true                           # 是否归档
tags:                                   # 标签
    - Socket
---
### 网络模型
> 计算机网络是指由通信线路互相连接的许多自主工作的计算机构成的集合体，各个部件之间以何种规则进行通信，就是网络模型研究的问题。网络模型一般是指OSI七层参考模型和TCP/IP四层参考模型。这两个模型在网络中应用最为广泛。（百度百科）


#### OSI七层模型
![NetworkModel-OSI](https://img-blog.csdn.net/20160731161720376)

#### TCP/IP四层模型
![TCP/IP](https://img-blog.csdn.net/20160731161739907)

**关于模型详细可参考阅读[OSI七层协议模型、TCP/IP四层模型学习笔记](https://www.cnblogs.com/Robin-YB/p/6668762.html)**

### TCP协议与UDP协议的区别
#### TCP
> 传输控制协议（TCP，Transmission Control Protocol）是一种面向连接的、可靠的、基于字节流的传输层通信协议,使用三次握手协议建立连接。

关于三次握手协议，四次挥手详细可以参考这篇文章[https://www.cnblogs.com/zmlctt/p/3690998.html](https://www.cnblogs.com/zmlctt/p/3690998.html)

#### UDP
> UDP协议，即用户数据报协议（User Datagram Protocol），是一个简单的面向数据报的传输层协议。UDP协议只在IP数据报服务商增加了很少一点的功能，就是复用和分用，以及差错检测的功能。

UDP协议特点：
* 无连接
* 不可靠
* 面向报文
* 只有8字节的信息包
* 没有拥堵控制

关于TCP及UDP之间更多详细及区别可以参考这篇知呼文章[https://zhuanlan.zhihu.com/p/24860273](https://zhuanlan.zhihu.com/p/24860273)

#### 简单的利用Java实现TCP连接

```java
class TcpServer {
	
    private static final int CORE_POOL_SIZE = 5;
    private static final int MAX_POOL_SIZE = 10;
    private static final int QUEUE_CAPACITY = 100;
    private static final Long KEEP_ALIVE_TIME = 1L;
    static ServerSocket ss = null;
    
	public static void main(String[] args) {
		System.out.println("TCP Server is starting ... (8080)");
		ThreadPoolExecutor executor = new ThreadPoolExecutor(
                CORE_POOL_SIZE,
                MAX_POOL_SIZE,
                KEEP_ALIVE_TIME,
                TimeUnit.SECONDS,
                new ArrayBlockingQueue<>(QUEUE_CAPACITY),
                new ThreadPoolExecutor.CallerRunsPolicy());
		try {
			ss = new ServerSocket(8080);
			while (true) {
				// accept client request block it
				executor.execute(() -> {
					try {
						Socket socket = ss.accept();
						InputStream is = socket.getInputStream();
						byte[] data = new byte[1024];
						int len = is.read(data);
						String result = new String(data, 0, len);
						System.out.println("Clinet: " + result);
						socket.close();
					} catch (IOException e) {
						e.printStackTrace();
					}
				});
			}
		} catch (IOException e) {
			e.printStackTrace();
		} finally {
			try {
				ss.close();
			} catch (IOException e) {
				e.printStackTrace();
			}
		}
	}
}

public class TcpClient {
	public static void main(String[] args) {
		System.out.println("TCP Client is starting ...");
		try {
			for (int i = 0; i < 10; i++) {
				Socket socket = new Socket("127.0.0.1", 8080);
				OutputStream os = socket.getOutputStream();
				os.write("This message is from TCP Client!".getBytes());
				socket.close();
			}
		} catch (UnknownHostException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
}
```

#### 简单的利用Java实现UDP连接

```java
class UdpServer {
	public static void main(String[] args) {
		System.out.println("UDP Server starting ... (port:8080)");
		// create server port
		try {
			DatagramSocket socket = new DatagramSocket(8080);
			// server access client 1024 byte
			byte[] data = new byte[1024];
			// define the data package
			DatagramPacket datagramPacket = new DatagramPacket(data, data.length);
			/*
			 *  Accept the client's request, encapsulate the data into a data packet
			 *  and block if there is no client connection
			 */
			socket.receive(datagramPacket);
			System.out.println("source IP address " + datagramPacket.getAddress() + " port " + datagramPacket.getPort());
			String result = new String(datagramPacket.getData(), 0, datagramPacket.getLength());
			System.out.println(result);
			socket.close();
		} catch (SocketException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
}

public class UdpClient {
	public static void main(String[] args) {
		System.out.println("UDP Client is starting...");
		// no port mean to create a socket client
		try {
			DatagramSocket ds = new DatagramSocket();
			String str = "This is a client message";
			byte[] strData = str.getBytes();
			DatagramPacket dp = new DatagramPacket(strData, strData.length, InetAddress.getByName("127.0.0.1"), 8080);
			ds.send(dp);
			ds.close();
		} catch (SocketException e) {
			e.printStackTrace();
		} catch (UnknownHostException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
}
```