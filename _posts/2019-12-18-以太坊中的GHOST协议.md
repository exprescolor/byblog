---
layout:     post 
title:      以太坊
subtitle:   以太坊中的GHOST协议
date:       2019-12-18
author:     张鹏
header-img: img/home-bg.jpg
catalog: true   
tags:                         
    - 区块链
---

#### GHOST协议

- 以太坊中的共识机制是GHOST协议
- 因为以太坊的出块时间相较比特币大幅缩短，所以出现分叉的几率也就大幅度的增加，如果以太坊沿用比特币的共识机制，那么对于大型矿池来说是占据相当大的优势的，因为他们的算力足够强，可以赶在个人挖矿用户发布新区块前找到符合条件的nonce，这样其实是对个人用户非常不友好的。
   - 所以以太坊采用了基于GHOST协议的共识机制。如下图
   - ![](https://ftp.bmp.ovh/imgs/2019/12/4925e87ce52b5c18.jpg)
   - 上图中没有成为最长合法链的区块也会得到一定的出块奖励，具体是八分之七的出块奖励（以太坊原本的出块奖励是5个以太币，现在是3个以太币）。并且把这些区块命名为uncle block（叔父区块），对于最长合法链来说，他们都是叔父区块。 
   - 当最长合法链发布的时候，可以把剩下的区块当作叔父区块，叔父区块可以得到八分之七的出块奖励。成为最长合法链的区块每包含一个叔父区块可以额外得到32分之1的出块奖励，最多包含两个叔父区块
   - **但是上述版本的GHOST有三个问题**：
      - 1.只能够包含两个叔父区块，如果存在第三个，那么第三个就会什么都得不到
      - 2.成为叔父区块的前提是，某个区块在称为最长合法链之前就知道某个区块的存在，那么他在发展下一个区块的时候就会把这个区块包含进去，从而让他成为叔父区块。但是如果称为最长合法链的区块事先并不知道某个区块的存在，那么他就没办法成为叔父区块
      - 3.某些矿池可能因为商业利益的原因故意不包含其他区块

- **针对上述三个问题，以太坊对GHOST协议进行了修改**
- ![](https://ftp.bmp.ovh/imgs/2019/12/309a0b5bc9e06bcf.jpg)
   - 以太坊中只承认现在是最长合法链的区块往前七代的区块成为叔父区块，并且每过一代得到的出块奖励就减少八分之一的出块奖励，但是包含叔父区块的区块每次都是得到32分之1的出块奖励。这样就会鼓励产生分叉的区块尽早的进行合并，因为越早进行合并。得到的出块奖励就越多。
- 对于比特币来说，得到奖励的途径有出块奖励和交易费两种途径。对于以太坊来说，得到奖励的途径有出块奖励和汽油费（gas fee：一个区块中包含了智能合约，执行智能合约的时候可以得到汽油费）两种方式。但是对于叔父区块来说，是得不到汽油费的，他只能得到最多八分之七的出块奖励。但是汽油费占很小的一部分，大部分都是静态的出块奖励。
- 对于包含了叔父区块的区块，是不需要执行叔父区块中的交易的。在验证叔父区块是否合法的时候，只需要验证叔父区块的块头是否符合难度要求即可，不需要检查区块内部的交易是否合法， 因为内部的交易反正不会执行，检不检查根本无所谓
- **以太坊中规定只有分叉后的第一个区块才能得到uncle reward，后面的区块都不可以，这样是为了防止分叉攻击**，如下图：
   - ![](https://ftp.bmp.ovh/imgs/2019/12/a8a05f21f0a3dfa9.jpg)
   - 以太坊中只承认分叉后的第一个区块为叔父区块。如果把整条链作为叔父区块，那么分叉攻击的代价就会大大降低。因为如果分叉攻击成功，那么他就可以回滚合法链的交易；如果分叉攻击失败，那么它也可以作为叔父区块获得出块奖励。