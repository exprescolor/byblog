---
layout:     post 
title:      Java基础0903
subtitle:   处理流
date:       2019-09-03
author:     张鹏
header-img: img/post-bg-debug.png
catalog: true   
tags:                         
    - Java
---

# Java基础

## 处理流

![处理流类别](https://github.com/Jokerboozp/Jokerboozp.github.io/raw/master/img/%E6%89%B9%E6%B3%A8%202019-09-03%20084141.png)

### 缓冲流

- 缓冲流要“套接”在相应的节点流之上，对读写的数据提供了缓冲的功能，提高了读写的效率，同时增加了一些新的方法
- JDK提供了四种缓存流，其常用的构造方法为：

```java
BufferedReader(Reader in)
BufferedReader(Reader in,int sz)//sz为自定义缓存区大小
BufferedWriter(Writer out)
BufferedWriter(Writer out,int sz)
BufferedInputStream(InputStream in)
BufferedInputStream(InputStream in,int size)
BufferedOutputStream(OutputStream out)
BufferedOutputStream(OutputStream out,int size)
```

- 缓冲输入流支持其父类的mark和reset方法
- BufferedReader提供了readLine方法用于读取一行字符（以\r或\n分隔）
- BufferedWriter提供了newLine用于写入一个行分隔符
- 对于输出的缓冲流，写出的数据会现在内存中缓存，使用flush方法将会使内存中的数据立刻写出
- 例1：

```java
import java.io.*;
public class TestBufferStream{
    public static void main(String[] args){
        try{
            FileInputStream fis=new FileInputStream("E:\\test\\Animal.java");
            BufferedInputStream bis=new BufferedInputStream(fis);
            int c=0;
            System.out.println(bis.read());
            System.out.println(bis.read());
            bis.mark(100);
            for(int i=0;i<10 && (c=bis.read())!=-1;i++){
                System.out.print(c+" ");
            }
            System.out.println();
            bis.reset();
            for(int i=0;i<10 && (c=bis.read())!=-1;i++){
                System.out.print(c+" ");
            }
            bis.close();
        }catch (IOException e){
            e.printStackTrace();
        }
    }
}
```

- 例2：

```java
import java.io.*;
public class TestBufferStream{
    public static void main(String[] args){
        try{
            BufferedWriter bw=new BufferedWriter(new FileWriter("E:\\test\\Animal.java"));
            BufferedReader br=new BufferedReader(new FileReader("E:\\test\\Animal.java"));
            String s=null;
            for(int i=0;i<=100;i++){
                s=String.valueOf(Math.random());
                bw.write(s);
                bw.newLine();
            }
            bw.flush();
            while((s=br.readLine())!=null){
                System.out.println(s);
            }
            bw.close();
            br.close();
        }catch(IOException e){
            e.printStackTrace();
        }
    }
}
```

### 转换流

- InputStreamReader和OutputStreamWriter可与字节数据到字符数据之间的转换
- InputStreamReader需要和InputStream“套接”
- OutputStreamWriter需要和OutputStream“套接”
- 转换流在构造时可以指定其编码集合，例如：

```java
InputStream isr=new InputStreamReader(System.in,"IOS8859-1");
```
- 例1：

```java
import java.io.*;
public class TestTransForm{
    public static void main(String[] args){
        try{
            OutputStreamWriter osw=new OutputStreamWriter(new FileOutputStream("E:\\test\\Animal.java"));
            osw.write("abcdefg");
            System.out.println(osw.getEncoding());
            osw.close();
            osw=new OutputStreamWriter(new FileOutputStream("E:\\test\\Animal.java",true),"ISO8859-1");//在文件后添加，而不是直接覆盖以前拥有的
            osw.write("abcdefg");
            System.out.println(osw.getEncoding());
            osw.close();
        }catch(IOException e){
            e.printStackTrace();
        }
    }
}
```
- 例2：

```java
import java.io.*;
public class TestTransForm{
    public static void main(String[] args){
        InputStreamReader isr=new InputStreamReader(System.in);
        BufferedReader br=new BufferedReader(isr);
        String s=null;
        try{
            s=br.readLine();
            while(s!=null){
                if(s.equalsIgnoreCase("exit"))break;
                System.out.println(s.toUpperCase());
                s=br.readLine();
            }
            br.close();
        }catch(IOException e){
            e.printStackTrace();
        }
    }
}
```

### 数据流

- DataInputStream和DataOutputStream分别继承自InputStream和OutputStream，它属于处理流，需要分别“套接”在InputStream和OutputStream类型的节点流上
- DataInputStream和DataOutputStream提供了可以存取与机器无关的Java原始类型数据（如int，double等）的方法
- DataInputStream和DataOutputStream的构造方法为：

```java
DataInputStream(InputStream in)
DataOutputStream(OutputStream out)
```
- 例子：

```java
import java.io.*;
public class TestDataStream{
    public static void main(String[] args){
        ByteArrayOutputStream baos=new ByteArrayOutputStream();
        DataOutputStream dos=new DataOutputStream(baos);
        try{
            dos.writeDouble(Math.random());
            dos.writeBoolean(true);
            ByteArrayInputStream bais=new ByteArrayInputStream(baos.toByteArray());
            System.out.println(bais.available());
            DataInputStream dis=new DataInputStream(bais);
            System.out.println(dis.readDouble());//先写入的先读出来 
            System.out.println(dis.readBoolean());
            dos.close();
            dis.close();
        }catch(IOException e){
            e.printStackTrace();
        }
    }
}
```

### Print流

- PrintWriter和PrintStream都属于输出流，分别针对与字符和字节
- PrintWriter和PrintStream提供了重载的Print方法
- Println方法可用于多种数据类型的输出
- PrintWriter和PrintStream的输出操作不会抛出异常，用户通过检测错误状态获取错误信息
- PrintWriter和PrintStream有自动flush功能
- 常用方法如下：

```java
PrintWriter(Writer out)
PrintWriter(Writer out,boolean autoFlush)
PrintWriter(OutputStream out)
PrintWriter(OutputStream out,boolean autoFlush)
PrintStream(OutputStream out)
PrintStream(OutputStream out,boolean autoFlush)
```
- 例1：

```java
import java.io.*;
public class TestPrintStream{
    public static void main(String[] args){
        PrintStream ps=null;
        try{
            FileOutputStream fos=new FileOutputStream("E:\\test\\Animal.java");
            ps=new PrintStream(fos);
        }catch(IOException e){
            e.printStackTrace();
        }
        if(ps!=null){
            System.setOut(ps);
        }
        int ln=0;
        for(char c=0;c<=60000;c++){
            System.out.println(c++);
            if(ln++>=100){
                System.out.println();
                ln=0;
            }
        }
    }
}
```
- 例2：

```java
import java.io.*;
public class TestPrintStream{
    public static void main(String[] args){
        String filename=args[0];
        if(filename!=null){
            list(filename,System.out);
        }
       }
        public static void list(String f,PrintStream fs){
            try{
                BufferedReader br=new BufferedReader(new FileReader(f));
                String s=null;
                while((s=br.readLine())!=null){
                    fs.println(s);
                }
                br.close();
            }catch(IOException e){
                fs.println("无法读取文件");
        }
    }
}
```
- 例3:

```java
import java.io.*;
import java.util.*;
public class TestPrintStream{
    public static void main(String[] args){
        String s=null;
        BufferedReader br=new BufferedReader(new InputStreamReader(System.in));
        try{
            FileWriter fw=new FileWriter("E:\\test\\Animal.java",true);
            PrintWriter log=new PrintWriter(fw);
            while((s=br.readLine())!=null){
                if(s.equalsIgnoreCase("exit"))break;
                System.out.println(s.toUpperCase());
                log.println("------");
                log.println(s.toUpperCase());
                log.flush();
            }
            log.println("===="+new Date()+"====");
            log.flush();
            log.close();
        }catch(IOException e){
            e.printStackTrace();
        }
    }
}
```

### Object流

- 直接将Object写入或读出
   - transient关键字
   - serializable接口
   - externalizable接口

```java
import java.io.*;
public class TestObjectIO{
    public static void main(String args[]) throws Exception{
        T t=new T();
        t.k=8;
        FileOutputStream fos=new FileOutputStream("E:\\test\\Animal.java");
        ObjectOutputStream oos=new ObjectOutputStream(fos);
        oos.writeObject(t);
        oos.flush();
        oos.close();
        FileInputStream fis=new FileInputStream("E:\\test\\Animal.java");
        ObjectInputStream cls=new ObjectInputStream(fis);
        T tReaded=(T)cls.readObject();
        System.out.println(tReaded.i+" "+tReaded.j+" "+tReaded.d+" "+tReaded.k);
    }
}
class T implements Serializable{
//Serializable接口：标记性的接口，如果想把某个列的对象序列化，则必须实现Serializable接口
    int i=10;
    int j=9;
    double d=2.3;
    transient int k=15;//transient关键字修饰的变量在序列化时不考虑
}
```