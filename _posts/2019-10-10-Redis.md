---
layout:     post 
title:      Redis教程
subtitle:   Redis
date:       2019-10-10
author:     张鹏
header-img: img/post-bg-keybord.jpg
catalog: true   
tags:                         
    - Redis
---

#### 什么是Redis

- Redis是一个开源的使用ANSI C编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言API。
- 换句话说，Redis就像是一个HashMap，不过不是在JVM中运行，而是以一个独立进程的形式运行
- 一般来说，Redis会被当作缓存使用。因为他比数据库快（Mysql）。所以常用的数据，可以考虑放在Redis中，这样就提高了性能。

#### Redis安装运行

- 解压缩即可安装
- 进入到解压路径，在地址栏输入cmd即可在当前路径下操作命令行
   - 启动Redis服务端、启动Redis客户端
   - redis-server.exe、redis-cli.exe
   - ![启动结果](https://github.com/Jokerboozp/Jokerboozp.github.io/raw/master/img/%E6%89%B9%E6%B3%A8%202019-10-10%20092030.png)
   - 简单使用
      - 客户端输入并获取相关信息
      - ![简单应用](https://github.com/Jokerboozp/Jokerboozp.github.io/raw/master/img/%E6%89%B9%E6%B3%A8%202019-10-10%20092659.png)

#### 基本数据类型

- Redis有5中基本数据类型：String（字符串）、List（列表）、Hash（字典）、Set（集合）、Sorted Set（有序集合）
   - String
   - ![String常用命令](https://github.com/Jokerboozp/Jokerboozp.github.io/raw/master/img/%E6%89%B9%E6%B3%A8%202019-10-10%20093714.png)
   - List
   - ![List常用](https://github.com/Jokerboozp/Jokerboozp.github.io/raw/master/img/%E6%89%B9%E6%B3%A8%202019-10-10%20094025.png)
   - Hash
   - ![Hash常用](https://github.com/Jokerboozp/Jokerboozp.github.io/raw/master/img/%E6%89%B9%E6%B3%A8%202019-10-10%20094218.png)
   - Set
   - ![Set常用](https://github.com/Jokerboozp/Jokerboozp.github.io/raw/master/img/%E6%89%B9%E6%B3%A8%202019-10-10%20094418.png)
   - Sorted Set
   - ![Sorted Set常用](https://github.com/Jokerboozp/Jokerboozp.github.io/raw/master/img/%E6%89%B9%E6%B3%A8%202019-10-10%20094725.png)
   - 具体命令解释请查看官方文档http://www.redis.cn/commands.html

#### 什么是Jedis

- 在常见命令中，使用各种Redis自带客户端的命令行方式去访问Redis服务，而在实际工作中却需要用到Java代码才能访问，使用第三方jar包：Jedis。就能够方便的访问Redis的各种服务了
- 下面代码就是一个简单的Jedis应用，它取出了foo的值

```java
package redis;

import redis.clients.jedis.Jedis;

public class TestRedis {
	public static void main(String[] args) {
		Jedis jedis = new Jedis("localhost");
		jedis.set("foo", "bar");
		String value = jedis.get("foo");
		System.out.println(value);
	}

}
```
- Jedis的复杂操作代码

```java
package redis;

import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import org.junit.Before;
import org.junit.Test;

import redis.clients.jedis.Jedis;
import redis.clients.jedis.JedisPool;

public class TestRedisManyCommands {

	JedisPool pool;
	Jedis jedis;
	@Before
	public void setup() {
		jedis = new Jedis("localhost");
	}
	
	/*
	 * Redis存储初级的字符串
	 * CRUD
	 */
	@Test
	public void testBasicString() {
		//添加数据
		jedis.set("name", "joker");
		System.out.println(jedis.get("name"));
		
		//修改数据
		jedis.append("name", "xiaoxian");
		System.out.println(jedis.get("name"));
		
		//直接覆盖原来的数据
		jedis.set("name", "zhangpeng");
		System.out.println(jedis.get("name"));
		
		//删除key对应的记录
		jedis.del("name");
		System.out.println(jedis.get("name"));
		
		//mset
		jedis.mset("name","joker","dota","poofu");
		System.out.println(jedis.mget("name","dota"));
	}
	
	/*
	 * Jedis操作Map
	 */
	@Test
	public void TestMap() {
		Map<String, String> user = new HashMap<>();
		user.put("name", "xiaoxian");
		user.put("pwd", "password");
		jedis.hmset("user",user);
		//取出user中的name，执行结果:[xiaoxian]。注意，结果是一个泛型的List
		//第一个参数是存入redis中map对象的key，后面跟的是放入map中的对象的key，后面的key可以跟多个，是可变参数
		List<String> rsmap = jedis.hmget("user", "name");
		System.out.println(rsmap);
		
		//删除map中的某个键值
		jedis.hdel("user", "pwd");
		System.out.println(jedis.hmget("user", "pwd"));//因为已被删除，所以返回的是null
		System.out.println(jedis.hlen("user"));//返回key为user的键中存放的值的个数1
		System.out.println(jedis.exists("user"));//是否存在key为user的记录，返回true
		System.out.println(jedis.hkeys("user"));//返回map对象中的所有key [name]
		System.out.println(jedis.hvals("user"));//返回map对象中的所有value [xiaoxian]
		
		Iterator<String> iter = jedis.hkeys("user").iterator();
		while(iter.hasNext()) {
			String key = iter.next();
			System.out.println(key+":"+jedis.hmget("user", key));
		}
	}
	
	/*
	 * Jedis操作List
	 */
	@Test
	public void TestList() {
		//开始前，先移除所有内容
		jedis.del("java framework");
		//第一个是key，第二个是起始位置，第三个是结束位置。jedis.llen获取长度，-1表示取得所有
		System.out.println(jedis.lrange("java framework", 0, -1));
		//先存放三条数据
		jedis.lpush("java framework", "spring");
		jedis.lpush("java framework", "struts2");
		jedis.lpush("java framework", "hibernate");
		//再取出所有数据。jedis.lrange是按范围取出
		//第一个是key，第二个是起始位置，第三个是结束位置。jedis.llen获取长度，-1表示取得所有
		System.out.println(jedis.lrange("java framework",0, -1));
	}
	
	/*
	 * Jedis操作Set
	 */
	@Test
	public void TestSet() {
		//添加
		jedis.sadd("sname", "zhangpeng");
		jedis.sadd("sname", "hushaung");
		jedis.sadd("sname", "zenghuanrui");
		jedis.sadd("sname", "joker");
		System.out.println(jedis.smembers("sname"));
		
		//移除joker
		jedis.srem("sname", "joker");
		System.out.println(jedis.smembers("sname"));//获取所有加入的value
		System.out.println(jedis.sismember("sname", "zhangpeng"));//判断zhangpeng是否是sname集合的元素
		System.out.println(jedis.srandmember("sname"));//随机返回集合sname中的一个元素
		System.out.println(jedis.scard("sname"));//返回集合的元素个数
	}
	
	@Test
	public void test() throws InterruptedException{
		//keys中传入的可以用通配符
		System.out.println(jedis.keys("*"));//返回当前库中的所有key
		System.out.println(jedis.keys("*name"));//返回[sname, name]
		jedis.del("list1");//删除key为list1的对象
		System.out.println(jedis.keys("*"));
		System.out.println(jedis.ttl("sname"));//返回给定key的有效时间，如果是-1则表示永远有效 
        jedis.setex("timekey", 10, "min");//通过此方法，可以指定key的存活（有效时间） 时间为秒 
        Thread.sleep(5000);//睡眠5秒后，剩余时间将为<=5 
        System.out.println(jedis.ttl("timekey"));   //输出结果为5 
        jedis.setex("timekey", 1, "min");        //设为1后，下面再看剩余时间就是1了 
        System.out.println(jedis.ttl("timekey"));  //输出结果为1 
        System.out.println(jedis.exists("key"));//检查key是否存在 
        System.out.println(jedis.rename("timekey","time")); 
        System.out.println(jedis.get("timekey"));//因为移除，返回为null 
        System.out.println(jedis.get("time")); //因为将timekey 重命名为time 所以可以取得值 min 
 
        //jedis 排序 
        //注意，此处的rpush和lpush是List的操作。是一个双向链表（但从表现来看的） 
        jedis.del("a");//先清除数据，再加入数据进行测试 
        jedis.rpush("a", "1"); 
        jedis.lpush("a","6"); 
        jedis.lpush("a","3"); 
        jedis.lpush("a","9"); 
        System.out.println(jedis.lrange("a",0,-1));// [9, 3, 6, 1] 
        System.out.println(jedis.sort("a")); //[1, 3, 6, 9]  //输入排序后结果 
        System.out.println(jedis.lrange("a",0,-1)); 
	}
}
```

#### Spring对Redis的支持