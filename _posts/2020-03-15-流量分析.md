---
layout:     post   				    # 使用的布局（不需要改）
title:       流量分析相关知识			# 标题 
#subtitle:   脚本，xss #副标题
date:       2020-03-15 				# 时间
author:     s-seven 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - CTF
---

这几天一直在做Misc的题，有一些知识点没有总结，现在回顾一下

# 几种常见的网络协议

- **ICMP**：它位于ISO参考模型的网络层，是网络控制报文协议，当IP数据包传送过程中发生错误时（源点抑制、路由不可达、参数问题等），ICMP协议会将错误信息封包，然后返回给主机。它有两大类：查询报文和差错报文，而在这个数据包中的ICMP是查询报文的类型（PING）；

- **ARP**：简单介绍它的功能用来通过MAC查询IP地址
  它是用于映射计算机的物理地址和临时指定的网络地址。启动时它选择一个协议(网络层)地址，并检查这个地址是否已经有别的计算机使用，如果没有被使用，此结点被使用这个地址，如果此地址已经被别的计算机使用，正在使用此地址的计算机会通告这一信息，只有再选另一个地址了。

- **SSH**：SSH协议（Secure Shell）是基于应用层的协议，他能在传输过程中为明文数据进行加密，安全性更高；它的工作过程大概为：

  ①版本号协商阶段：SSH目前包括 SSHv1和SSHv2两个版本， 双方通过版本协商确定使用的版本；

  ②密钥和算法协商阶段：SSH支持多种加密算法， 双方根据本端和对端支持的算法，协商出最终使用的算法；

  ③认证阶段：SSH客户端向服务器端发起认证请求， 服务器端对客户端进行认证；

  ④会话请求阶段：认证通过后，客户端向服务器端发送会话请求；

  ⑤交互会话阶段 ：会话请求通过后，服务器端和客户端进行信息的交互

- **NFS**：就是通过网络共享目录，让网络上的其他服务器能够挂载访问共享目录内的数据（一般共享视频，图片等静态数据）；

- **RPC(Remote Procedure Call)**：因为NFS本身是没有提供信息传输的协议和功能的，但NFS却能让我们通过网络来分享资料，这是因为NFS使用了一些其它的传输协议，而这些传输协议用到了RPC的功能。

- **FTP**(File Transfer Protocol)文件传输协议 
  它是一个标准协议，是在计算机和网络之间交换文件的最简单的方法。像传送可显示文件的HTTP和电子邮件的SMTP一样，FTP也是应用TCP/IP协议的应用协议标准。FTP通常用于将网页从创作者上传到服务器上供人使用，
  而从服务器上下传文件也是一种非常普遍的使用方式。

- **HTTPS**(Secure Hypertext Transfer Protocol)安全超文本传输协议 
  它是由Netscape开发并内置于其浏览器中，用于对数据进行压缩和解压操作，并返回网络上传送回的结果。HTTPS实际上应用了Netscape的完全套接字层(SSL)作为HTTP应用层的子层。

  # 几种编码方式

  在解Misc题的时候经常出现base64，ASCII码等编码方式，下面是几种常见的编码方式：

  ## ASCII码

  ASCII(American Standard Code for Information Interchange，美国信息交换标准代码)是基于拉丁字母的一套 电脑编码系统，主要用于显示现代英语和其他西欧语言。它是现今最通用的单字节编码系统，并等同于国际标准ISO/IEC 646。

  特点：一般常用字符为0-9（48-57）、A-Z（65-90）、a-z（97-122）、空格（32）

  ## Base编码

  Base64是网络上最常见的用于传输8Bit字节码的编码方式之一，Base64 就是一种基于64(65)个可打印字符来表示二进制数据的方法。 a-z、A-Z、0-9、符号“+”、“/”（再加上作为补位的"="，实际上是 65个字符） 。

  Base xx 中的 xx 表示的是采用多少个字符进行编码，比如说 base64 就是采用 64 个字符编码，由于 2 的 6 次方等于 64，所以每 6 个比特 为一个单元，对应某个可打印字符。

  例如：d2VsY29tZQ==   ==>welcome

  特点：base64 结尾可能会有=号，但最多有2个 。

  base32 结尾可能会有=号,最多有 3 个等号

  根据 base 的不同，字符集会有所限制 。

## URL编码

 URL编码,又叫百分号编码，是统一资源定位(URL)编码方式。URL地址 （常说网址）规定了常用地数字，字母可以直接使用，另外一批作为特殊 用户字符也可以直接用（/,:@等），剩下的其它所有字符必须通过%xx编码 处理。 现在已经成为一种规范了，基本所有程序语言都有这种编码，如js： 有encodeURI、encodeURIComponent，PHP有 urlencode、urldecode等。编 码方法很简单，在该字节ascii码的的16进制字符前面加%. 如空格字符， ascii码是32，对应16进制是‘20’，那么urlencode编码结果是:%20。

例如：URL%E7%BC%96%E7%A0%81   ==> URL编码
特点：存在大量%

## Unicode编码

Unicode（统一码、万国码、单一码）是计算机科学领域里的一项业界 标准,包括字符集、编码方案等。Unicode 是为了解决传统的字符编码方案 的局限而产生的，它为每种语言中的每个字符设定了统一并且唯一的二进 制编码，以满足跨语言、跨平台进行文本转换、处理的要求。1990年开始 研发，1994年正式公布。

# docx格式

docx是微软Word的文件扩展名，Microsoft Office2007之后版本使用，其基于Office Open XML标准的压缩文件格式取代了其以前专有的默认文件格式，在传统的文件名扩展名后面添加了字母“x”（即“.docx”取代“.doc”、“.xlsx”取代“.xls”、“.pptx”取代“.ppt”）。任何能够打开DOC文件的文字处理软件都可以将该文档转换为DOCX文件，docx文件比doc文件所占用空间更小，docx格式的文件本质上是一个ZIP文件。

# PNG文件结构

> https://www.cnblogs.com/ECJTUACM-873284962/p/8986391.html>

这篇文章对png的文件结构有一个很详细的解释

**文件头**

根据PNG文件的定义来说，其文件头位置总是由位固定的字节来描述的：

十进制数      137 80 78 71 13 10 26 10
十六进制数   89 50 4E 47 0D 0A 1A 0A

**PNG数据块（Chunk）**

PNG定义了两种类型的数据块，一种是称为关键数据块(critical chunk)，这是标准的数据块，另一种叫做辅助数据块(ancillary chunks)，这是可选的数据块。关键数据块定义了4个标准数据块，每个PNG文件都必须包含它们，PNG读写软件也都必须要支持这些数据块。虽然PNG文件规范没有要求PNG编译码器对可选数据块进行编码和译码，但规范提倡支持可选数据块。

**数据块结构**

PNG文件中，每个数据块由4个部分组成，如下：

| **名称**                       | **字节数** | **说明**                                           |
| ------------------------------ | ---------- | -------------------------------------------------- |
| Length (长度)                  | 4字节      | 指定数据块中数据域的长度，其长度不超过(231－1)字节 |
| Chunk Type Code (数据块类型码) | 4字节      | 数据块类型码由ASCII字母(A-Z和a-z)组成              |
| Chunk Data (数据块数据)        | 可变长度   | 存储按照Chunk Type Code指定的数据                  |
| CRC (循环冗余检测)             | 4字节      | 存储用来检测是否有错误的循环冗余码                 |

**IHDR**

文件头数据块IHDR(header chunk)：它包含有PNG文件中存储的图像数据的基本信息，并要作为第一个数据块出现在PNG数据流中，而且一个PNG数据流中只能有一个文件头数据块。

**PLTE**

调色板数据块PLTE(palette chunk)包含有与索引彩色图像(indexed-color image)相关的彩色变换数据，它仅与索引彩色图像有关，而且要放在图像数据块(image data chunk)之前。

**DAT**

图像数据块IDAT(image data chunk)：它存储实际的数据，在数据流中可包含多个连续顺序的图像数据块。

IDAT存放着图像真正的数据信息，因此，如果能够了解IDAT的结构，我们就可以很方便的生成PNG图像。

**IEND**

图像结束数据IEND(image trailer chunk)：它用来标记PNG文件或者数据流已经结束，并且必须要放在文件的尾部

如果我们仔细观察PNG文件，我们会发现，文件的结尾12个字符看起来总应该是这样的：

00 00 00 00 49 45 4E 44 AE 42 60 82

由于数据块结构的定义，IEND数据块的长度总是0（00 00 00 00，除非人为加入信息），数据标识总是IEND（49 45 4E 44），因此，CRC码也总是AE 42 60 82。

然后我们看invisible flag这道题，分析一下这张图片的结构

![4.jpg](http://ww1.sinaimg.cn/large/005KQQDely1gcuyi0n1nhj30n80g8ad7.jpg)

用010Editor打开图片，开头是png文件的文件头89 50 4E 47 0D 0A 1A 0A

再下来是文件头数据块00 00 00 0D，数据块长度是13b

49 48 44 52 :IHDR标记

00 00 02 34：宽度

00 00 01 90：高度

...

最后49 45 4E 44 ：IEND标志

然后我们把图片的高度改为和宽度一样，就可以看到flag了

