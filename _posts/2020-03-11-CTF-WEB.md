---
layout:     post   				    # 使用的布局（不需要改）
title:       	Calculator（原来脚本是这么写的）			# 标题 
#subtitle:   脚本，xss #副标题
date:       2020-03-11 				# 时间
author:     s-seven 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 学习
---

# Calculator

这道题要求在1.5秒内提交式子的结果，我想不出不用python的方法，只能写脚本计算，代码如下

```python
import re
import requests 
s=requests.Session()
url="http://vps1.blue-whale.me:23331/calculator/"
r = s.get(url)
r.encoding = 'utf-8'   #修改编码

print(r.text)

num = re.findall(re.compile("(\d.*?)="), r.text)[0]  #正则表达式找到算术式 
print ('result:\n\n%s=%d\n' % (num, eval(num)))  #输出算术式计算结果
#到这一步是可以返回算数式和结果的
#一种提交到网页的方法
rs= s.get(url, data={'answer': eval(num)})  #将结果提交  
print (rs.text)  #输出返回结果
#另一种方式
data={'v': eval(num)}
header = {'Cookie': 'PHPSESSID=95f7fdd0d60a4b46bdcbbcfe255343ad'}
resp_content = requests.get(url, headers=header, data=data).content.decode('utf-8')  
matches = re.search("<body>(.*)</body>", resp_content)  
print(resp_content )
```

这是我第一次使用Python语言/(ㄒoㄒ)/~~

这个代码有几处要注意的地方，

一个就是题中提示的服务器要知道获得算式和提交答案的是一个人，所以要获取session，通过PHPSESSID来控制

还有一个就是正则表达式，用到了findall和compile两个函数，"(\d.*?)=" 数字开头，等号结尾，*代表多次，？代表正向匹配

#re.compile()

re.compile()方法可以将正则字符串编译成正则表达式对象，以便在后面的匹配中复用

`re.compile(pattern[, flags])`	

re.compile()中可以传入忽略换行等匹配模式，这样在search()、findall()方法中就不需要额外传入了。

# re.findall()

re.findall()在字符串中找到正则表达式所匹配的**所有**子串，并返回一个列表；如果没有找到匹配的，则返回空列表。

返回结果是列表类型，需要遍历一下才能依次获取每组内容。

`

```python
findall(patern, string, flags=0)
```



- pattern : 正则中的模式字符串。

- string : 要被查找替换的原始字符串。

- flags : 标志位，用于控制正则表达式的匹配方式，如：是否区分大小写，多行匹配等等。

  因此，re.findall()方法有2种表达方式：

```python
import re
content = 'one1two22three333four4444'
pattern = re.compile(r'\d+')
print('===方法1：===')
result1 = re.findall(pattern, content)
print(result1) 
print('===方法2===')
result2 = pattern.findall(content)
print(result2)
```


## 未完待续

![屏幕截图.jpg](http://ww1.sinaimg.cn/large/005KQQDely1gcq1jv901ej30go0cpjrz.jpg)

折腾了一上午，我只做到了将算数式找到并计算，网两种提交结果的方式，返回值都是原始网页，没有找到flag，应该是提交方式不太对
