---
layout:     post 
title:      Shiro基础0922
subtitle:   实现授权Realm、Shiro标签
date:       2019-09-22
author:     张鹏
header-img: img/post-bg-YesOrNo.jpg
catalog: true   
tags:                         
    - Shiro
---

#### 实现授权Realm
- 实现步骤

1. 从PrincipalCollection中来获取登陆用户的信息
2. 利用登录的用户信息来获取当前用户的角色或权限（可能需要查询数据库）
3. 创建SimpleAuthorizationInfo，并设置其roles属性
4. 返回SimpleAuthorizationInfo对象

- ShiroRealm.java


```java
	@Override
	protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {
		//1.从PrincipalCollection中来获取登陆用户的信息
		Object principal=principals.getPrimaryPrincipal();
		//2.利用登录的用户信息来获取当前用户的角色或权限（可能需要查询数据库）
		Set<String> roles=new HashSet<>();
		roles.add("user");
		if ("admin".equals(principal)) {
			roles.add("admin");
		}
		//3.创建SimpleAuthorizationInfo，并设置其roles属性
		SimpleAuthorizationInfo info = new SimpleAuthorizationInfo(roles);
		//4.返回SimpleAuthorizationInfo对象
		return info;
	}
```

- 实现结果：用户输入的用户名是admin时，可以访问adminpage和userpage；用户输入的用户名是user时，只能访问userpage

#### Shiro标签

- Shiro提供了JSTL标签用于在JSP页面进行权限控制，如根据用户登陆显示相应的页面按钮

1. guest标签：用户没有身份验证时显示相应信息，即游客访问信息

```jsp
<shiro:guest>
欢迎游客访问，<a href="login.jsp">登陆</a>
</shiro:guest>
```

2. user标签：用户已经经过认证/**记住我**登陆后显示相应的信息

```jsp
<shiro:user>
欢迎[<shiro:principal/>]登陆，<a href="logout">退出</a>
</shiro:user>
```

3. authenticated标签：用户已经身份验证通过，即Subject.login登陆成功，**不是记住我登陆的**

```jsp
<shiro:authenticated>
用户[<shiro:principal/>]已身份验证通过
</shiro:authenticated>
```

4. notAuthenticated标签：用户未进行身份验证，即没有调用Subject.login进行登陆，**包括记住我自动登录**的也属于未进行身份验证

```jsp
<shiro:notAuthenticated>
未身份验证（包括记住我）
</shiro:notAuthenticated/>
```

5. principal标签：显示用户身份信息，默认调用Subject.getPrincipal()获取，即Primary Principal

```jsp
<shiro:principal property="username"/>
```

6. hasRole标签：如果当前Subject有角色将显示body体内容

```jsp
<shiro:hasRole name="admin">
用户[<shrio:principal/>]拥有角色admin<br/>
</shiro:hasRole>
```

7. hasAnyRoles标签：如果当前Subject有任意一个角色（或的关系）将显示body体内容

```jsp
<shiro:hasAnyRoles name="admin,user">
用户[<shiro:principal/>]拥有角色admin或user<br/>
</shiro:hasAnyRoles>
```