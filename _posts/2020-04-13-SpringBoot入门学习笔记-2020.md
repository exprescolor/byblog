---
layout:     post                        # 使用的布局（不需要改）
title:      SpringBoot 学习笔记              # 标题
subtitle:   个人学习记录                  # 副标题
date:       2020-04-13                  # 时间
author:     AhogeK                      # 作者
header-img:  https://ahogek.github.io/img/post-unix-linux.jpg    # 这篇文章标题背景图片
catalog: true                           # 是否归档
tags:                                   # 标签
    - SpringBoot
    - 学习笔记
---

### 目录
1. 第一个SpringBoot程序
2. 自定义属性配置
3. Controller的使用
4. spring-data-jpa
5. 事物管理

### 前置知识
1. 利用maven构建项目
2. Spring注解
3. RESTful API

---

**maven 运行**
``mvn spring-boot:run``

**maven 打包**
``mvn clean package -Dmaven.test.skip=true -U``

**java运行**
``java -jar luckymoney-0.0.1-SNAPSHOT.jar`` 

---

#### 项目属性配置

```properties
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/
spring.datasource.username=root
spring.datasource.password:=123456
spring.datasource.driver-class-name=com.mysql.jdbc
```

修改端口 ``server.prot=8081``

``server.servlet.context-path=/luckmoney`` *头路径地址*

**yml写法**

```yml
server:
  port: 8080
  servlet:
    context-path: /luckmoney
```

配置中的自己定义配置可以通过
```java
@Value("${minMoney}")
private BigDecimal minMoney;
```
方式获取配置文件中的值

关于使用 *@ConfigurationProperties* 报Configuration Annotation Proessor not found in classpath

官方解决方法是引入依赖
```xml
<dependency>
    <groupId> org.springframework.boot </groupId>
    <artifactId> spring-boot-configuration-processor </artifactId>
    <optional> true </optional>
</dependency>
```

可将公共配置做成一个配置类
例如yml配置文件中提取相关配置为一个类
```yml
limit:
  minMoney: 2
  maxMoney: 9999
  description: 最少要发${limit.minMoney}元
```
然后新建一个Class类来注入相关属性
```java
@Component
@ConfigurationProperties(prefix = "limit")
public class LimitConfig {

    private BigDecimal minMoney;

    private BigDecimal maxMoney;

    private String description;

    public BigDecimal getMinMoney() {
        return minMoney;
    }

    public void setMinMoney(BigDecimal minMoney) {
        this.minMoney = minMoney;
    }

    public BigDecimal getMaxMoney() {
        return maxMoney;
    }

    public void setMaxMoney(BigDecimal maxMoney) {
        this.maxMoney = maxMoney;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }
}
```

*打开发包运行生产配置的方式*
``java -jar -Dspring.profiles.active=prod target/luckymoney-0.0.1-SNAPSHOT.jar``

#### Controller的使用

<table>
    <tr>
        <td>@Controller</td>
        <td>处理http请求</td>
    </tr>
    <tr>
        <td>@RestController</td>
        <td>Spring4之后新加的注解，原来返回json需要@ResponseBody配合@Controller</td>
    </tr>
    <tr>
        <td>@RequestMapping</td>
        <td>配置url映射</td>
    </tr>
</table>

**使用@Controller 不能直接返回json需要使用模板或添加@ResponseBody注解**
``spring-boot-starter-thymeleaf``

*Mapping注解可传数组*

##### 参数

<table>
    <tr>
        <td>@PathVariable</td>
        <td>获取url中的数据</td>
    </tr>
    <tr>
        <td>@RequestParam</td>
        <td>获取请求参数的值</td>
    </tr>
</table>

*如果是跟在url/后 使用 @PathVariable*
``@GetMapping("/hello/{id}")``
``@PathVariable("id") Integer id``

*如果是 @RequestParam 是？id=....的形式*
``@RequestParam("id") Integer id``

**去除必传**
``@RequestParam(value = "id", required = false, defaultValue = "0") Integer id``

---

#### Spring-Data-Jpa

> JPA(Java Persistence API) 定义了一系列对象持久化标准，目前实现这一规范的产品有 Hibernate、TopLink等。
