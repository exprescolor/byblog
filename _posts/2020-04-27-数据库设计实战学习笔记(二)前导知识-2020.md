---
layout:     post                        # 使用的布局（不需要改）
title:      数据库设计实战学习笔记(二)前导知识              # 标题
subtitle:   新零售数据库设计与实战笔记                  # 副标题
date:       2020-04-27                  # 时间
author:     AhogeK                      # 作者
header-img:  https://tr3.cbsistatic.com/hub/i/r/2016/08/02/ffb48ac0-b355-4aec-b814-04c79e1e1bfd/resize/1200x/292c4adbf288356b843876804b244d69/mysqlhero.jpg    # 这篇文章标题背景图片
catalog: true                           # 是否归档
tags:                                   # 标签
    - MySQL
    - 慕课学习笔记
---
### 安装MySQL
#### CentOS禁用SELinux安全模块

> SELinux 是美国国防部开发的一个安全模块被Linux所沿用，但它会影响到其他程序的正常运行，因此建议关闭（部分linux已取消 例如 Ubuntu)

``vi /etc/selinux/config`` 中
将 ``SELINUX=enforcing``
修改为 ``selinux=disabled``
并重启系统

#### 替换yum源

``curl -o /etc/yum.repos.d/CentOS-Base.repo mirrors.163.com/.help/CentOS&-Base-163.repo``

#### 更新缓存
``yum clean all``
``yum makecache``

#### yum localinstall
CentOS 用于安装**本地rpm**包指令，它会自动联网处理本地rpm包可能存在的依赖. 也可以使用http的路径下载rpm包

安装MySQL
``yum install mysql-community-server -y``
**-y** ：任何请求都回答 yes

*对于安装 MySQL Server 也可以使用本地安装*
需要安装第三方程序包
```
yum install perl -y
yum install net-tools -y
```

rpm 包安装指令
``rpm -ivm [rpm package]``

搜索程序包名
``rpm -qa|grep [package name]``
卸载程序包
``rpm -e [package name] --nodeps``

*修改 /var/lib/mysql 目录的访问权限*
``chmod -R 777 /var/lib/mysql/``

初始化
```
mysqld --initialize  # 初始化MySQL的数据目录
chomd -R 777 /var/lib/mysql/*
```

启动数据库
``service mysql / mysqld start``
*本地安装使用mysqld*

通过日志查看数据库初始化密码
``grep 'temporary password' /var/log/mysqld.log``

### 配置MySQL数据库

* 本地登录数据库
``mysql -u root -p``

* 修改root密码
``alter user usre() identified by "abc123456"``

* 允许远程使用root账户
``UPDATE mysql.user SET host = '%' WHERE user='root';``
``FLUSH PRIVILEGES;``
修改 */etc/my.cnf* 文件

```cnf
character_set_server = utf8
bind-address = 0.0.0.0
```
重启服务

* 系统防火墙开放3306端口
``firewall-cmd --zone=public --add-port=3306/tcp --permanent``
**--permanent**: 防火墙的设置永久生效
**--zone=public**: 添加至 public 空间
重载防火墙
``firewall-cmd --reload``

### 如何看懂ER图
#### 业务数据库设计流程
* *需求分析：* 根据用户的需求，分析出需要记录的数据
* *概要设计：* 根据分析出的数据，设计ER图
* *详细设计：* 将ER图转换成数据库模型图和数据表

#### 瀑布模型还是螺旋模型
* 瀑布模型（Waterfall Model） 是一个项目开发架构，开发过程是通过设计一系列阶段顺序展开的，从系统需求分析开始直到产品发布和维护，每个阶段都会产生循环反馈，因此，如果有信息未被覆盖或者发现了问题，那么最好 “返回”上一个阶段并进行适当的修改，项目开发进程从一个阶段“流动”到下一个阶段，这也是瀑布模型名称的由来。
![Waterfall Model](https://pic1.zhimg.com/v2-02b883ccec8b0036afe8a062c48d5af2_1200x500.jpg)

* 螺旋模型（Spiral model）是一种演化软件开发过程模型，它兼顾了快速原型的迭代的特征以及瀑布模型的系统化与严格监控。螺旋模型最大的特点在于引入了其他模型不具备的风险分析，使软件在无法排除重大风险时有机会停止，以减小损失。 同时，在每个迭代阶段构建原型是螺旋模型用以减小风险的途径。
![Spiral model](https://img2018.cnblogs.com/common/1596700/201911/1596700-20191128131439638-429295479.jpg)

#### 什么是ER图
> E-R图也称实体-联系图(Entity Relationship Diagram)，提供了表示实体类型、属性和联系的方法，用来描述现实世界的概念模型。 它是描述现实世界关系概念模型的有效方法。 是表示概念关系模型的一种方式。

#### ER图与用例图对比
* ER图
![ER](https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/Screenshot%20from%202020-04-28%2014-41-30.png)
* 用例图
![用例图](https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/Screenshot%20from%202020-04-28%2014-43-27.png)

#### 绘制ER图工具
* [Office Visio](https://www.microsoft.com/en-us/microsoft-365/visio/flowchart-software)、[Office Word](https://www.microsoft.com/en-us/microsoft-365/word)
* [亿图图示(Edraw)](https://www.edrawsoft.cn/)
* [Enterprise Architect(EA)](https://sparxsystems.com/)
* [processon](https://www.processon.com/)

#### ER图属性语法（一）
* 复合属性是多个属性的组合
![复合属性](https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/Screenshot%20from%202020-04-28%2015-13-04.png)
* 多值属性是某个属性可以有多个不同的取值
![多值属性](https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/Screenshot%20from%202020-04-28%2015-16-46.png)
* 派生属性是不保存在实体中的属性
![派生属性](https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/Screenshot%20from%202020-04-28%2015-20-44.png)
* 可选属性是允许没有值的属性
![可选属性](https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/Screenshot%20from%202020-04-28%2015-23-57.png)

#### 实体关系语法
1-1
![实体关系1-1](https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/Screenshot%20from%202020-04-28%2016-01-27.png)
1-N
![1-N](https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/Screenshot%20from%202020-04-28%2016-07-20.png)
N-M
![N-M](https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/Screenshot%20from%202020-04-28%2016-09-59.png)

#### 数据库模型图
![模型图](https://www.navicat.com.cn/images/product_screenshot/ProductInfo_NDM3_01_mainUI_win_light_CN.png)

### CRUD操作
#### 选用InnoDB引擎
##### MyISAM引擎
>MyISAM是MySQL的默认数据库引擎（5.5版之前），由早期的ISAM（Indexed Sequential Access Method：有索引的顺序访问方法）所改良。虽然性能极佳，但却有一个缺点：不支持事务处理（transaction）。不过，在这几年的发展下，MySQL也导入了InnoDB（另一种数据库引擎），以强化参考完整性与并发违规处理机制，后来就逐渐取代MyISAM。

##### InnoDB引擎
>InnoDB，是MySQL的数据库引擎之一，为MySQL AB发布binary的标准之一。InnoDB由Innobase Oy公司所开发，2006年五月时由甲骨文公司并购。与传统的ISAM与MyISAM相比，InnoDB的最大特色就是支持了ACID兼容的事务（Transaction）功能，类似于PostgreSQL。目前InnoDB采用双轨制授权，一是GPL授权，另一是专有软件授权。

##### ToKuDB引擎
>TokuDB是TokuTek公司（已被 Percona收购）研发的新引擎，支持事务/MVCC，有着出色的数据压缩功能，支持异步写入数据功能。TokuDB索引结构采用fractal tree数据结构，是buffer tree的变种，写入性能优异，适合写多读少的场景。除此之外，TokuDB还支持在线加减字段，在线创建索引，锁表时间很短。Percona Server和Mariadb支持TokuDB作为大数据场景下的引擎。ApsaraDB for MySQL从2015年4月开始支持TokuDB，在大数据或者高并发写入场景下推荐使用。

##### 导入SQL文件
``mysql>source [mysql.sql]``

##### 数据插入
* 批量插入数据，因为一条记录的问题，全部数据都写入失败
```sql
INSERT IGNORE INTO t_dept(deptno, dname, loc)
VALUES (40, "企业部", "北京"),
       (50, "培训部", "上海"),
       (60, "后勤部", "北京"),
       (70, "技术部", "北京"),
       (80, "市场部", "北京");
```
**IGNORE** 用于忽略错误，避免第一条错误导致后面正确的无法插入

* 如何实现不存在就插入，存在就更新？
```sql
INSERT INTO t_emp_ip(id, empno, ip) VALUES
(5, 8004, "192.168.99.44"),
(6, 8005, "192.168.99.45"),
(7, 8006, "192.168.99.46"),
(8, 8007, "192.168.99.47")
ON DUPLICATE KEY UPDATE ip=VALUE(ip);
```
**ON DUPLICATE KEY UPDATE ip=VALUE(ip);** 出现主键重复更新ip