---
layout:     post 
title:      以太坊
subtitle:   以太坊账户
date:       2019-12-16
author:     张鹏
header-img: img/home-bg.jpg
catalog: true   
tags:                         
    - 区块链
---

#### 以太坊账户

- 比特币中用的是基于交易的账本，这种情况下系统中并没有显式的记录每个账户上有多少钱（需要计算UTXO中的值才能知道某个账户有多少比特币）。这种模式的好处是隐私保护特别好，你有多少钱，可能自己都不清楚。但是这样带来一个问题：它使用上是比较别扭的，像用户在花费比特币的时候，需要把现在账户内的余额全部花出去，否则剩余的比特币就会作为交易费转发给矿工。这样的原因是比特币系统中没有显式的维护这种基于账户的交易的概念，他是每个交易单独进行处理的。
- 以太坊系统是基于账户的模型，这种模型和我们日常的银行账户是比较相似的，就是系统中要显式的记录账户中有几个以太币。以太币在验证交易是否合法的时候只需要验证账户中是否有足够的以太币即可，不需要像比特币一样验证当前账户的金额的来源。

#### replay attack（重放攻击）

- 比特币面临的主要挑战是double spending attack。而以太坊这种基于账户的模型对double spending attack有 天然的防御作用
   - 因为以太坊不需要知道币的来源，只需要知道当前账户是否有足够的余额即可。你每花一次钱，系统就直接扣除账户余额的钱即可，如果有人想要double spending attack，那系统就会直接扣两次

- **重放攻击**：A发布一个交易，过一段时间之后这个交易被写入到区块链中，A就认为这个交易是完成了。假设B是有恶意的，他把A的交易又在网上重新广播了一遍，其他节点就认为A又发布了一个交易，就又扣了A的余额一次
- double spending attack是花钱的人不诚实，花过的钱想要再花一遍；replay attack是收钱的人不诚实，别人给你转过钱了，你想让他再转一遍
- 比特币当中是不可能出现重放攻击的，因为他也是一个显然的double spending。

#### 以太坊对于重放攻击的解决办法

- 记录一下当前账户有史以来一共发生过多少次交易，也就是加一个计数器nonce。转账的时候这个交易次数要作为交易内容的一部分包含进去，都是收到发布交易的人的签名的保护的

#### 以太坊中的账户

- 以太坊中有两类账户，一类叫做外部账户（externally owned account）：类似于比特币中的那种普通的账户，由公私钥对进行控制。本地产生一个公私钥对，谁拥有这个公私钥对，谁就对这个账户拥有所有权。
   - 外部账户的状态包括：账户余额（balance），交易次数（nonce）
- 以太坊中的另一种账户叫做合约账户（smart contract account）：合约账户不是通过公私钥对来进行控制。合约账户也是拥有nonce的，一个合约可以调用另外一个合约，所以他就需要nonce值来记录一下调用的次数。但是**合约账户不能主动发起一个交易，所有的交易只能通过外部账户发起**。外部账户发起了一个交易，调用了一个合约账户，这个合约账户可以发送一个信息调用另外一个合约，但是他不能够自己平白的发起一个交易
   - 合约账户的状态包括：调用次数（nonce），代码（code），存储（storage）

- 当你创建合约的时候，会返回给你一个地址。知道这个地址就可以调用这个合约