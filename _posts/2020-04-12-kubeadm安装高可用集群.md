---
title: kubeadm安装kubernetes高可用集群
date: 2020-04-12
header-img: img/123.jpg
catalog: true
tags: k8s
---

#### 机器规划

注意事项：
* 服务器之间网络互通
* 服务器能访问公网或者内网有镜像仓库yum源原子钟等基础设施
* etcd节点数量必须是奇数，可选用kubeadm自动搭建也可选用外部etcd集群
* master节点高可用最少是三台
* 负载VIP通过keepalived和haproxy来实现apiserver的高可用，可以是自己内网一个没有用的ip地址也可以是共有云的lb
* 服务器之间的时间需要同步

| 节点主机名     | IP地址               | 角色                | 部署服务                                             |
| ---------------|--------------------- |---------------------|------------------------------------------------------|
| k8s-master-001 |172.17.113.80         |master+etcd          |kubeadm、kubelet、kubectl、docker、haproxy、keepalived|
| k8s-master-002 |172.17.113.81         |master+etcd          |kubeadm、kubelet、kubectl、docker、haproxy、keepalived|
| k8s-master-003 |172.17.113.82         |master+etcd          |kubeadm、kubelet、kubectl、docker                     |
| k8s-node-001   |172.17.113.83         |node                 |kubeadm、kubelet、docker                              |
| k8s-node-002   |172.17.113.84         |node                 |kubeadm、kubelet、docker                              |
| 负载VIP        |172.17.113.79         |VIP                  |                                                      |

#### 服务版本规划

如果使用yum安装的话可以通过命令查看可支持的rpm包的版本
```
yum list docker-ce --showduplicates | sort -r 
```
docker和kubernetes的版本有依赖关系可通过 https://github.com/kubernetes/kubernetes/tree/master/CHANGELOG 查看CHANGELOG看想要安装的k8s的版本支持的docker版本


| 服务名称       | version                     |
| ---------------|-----------------------------|
| docker         | 19.03.8-3.el7               |
| kubeadm        | 1.17.4-0                    |
| kubectl        | 1.17.4-0                    |
| kubelet        | 1.17.4-0                    |
| etcd           |                             |
| OS             | CentOS  7.7.1908            |
| kernel         | 3.10.0-1062.18.1.el7.x86_64 |
| kube-proxy     |                             |
| flannel        |                             |
| keepalived     |                             |
| haproxy        |                             |

附部分版本的对应信息
| Kubernetes版本    | Docker版本                                                   |
| ------------------|--------------------------------------------------------------|
| Kubernetes 1.18.x | Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09、19.03   |
| Kubernetes 1.17.x | Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09、19.03   |
| Kubernetes 1.16.x | Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09          |
| Kubernetes 1.15.x | Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09          |
| Kubernetes 1.14.x | Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09          |
| Kubernetes 1.13.x | Docker版本1.11.1、1.12.1、1.13.1、17.03、17.06、17.09、18.06 |
| Kubernetes 1.12.* | Docker版本1.11.1、1.12.1、1.13.1、17.03、17.06、17.09、18.06 |
| Kubernetes 1.11.* | Docker版本1.11.2到1.13.1、17.03                              |
| Kubernetes 1.10.* | Docker版本1.11.2到1.13.1、17.03                              |




