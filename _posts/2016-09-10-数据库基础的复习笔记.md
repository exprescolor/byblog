---
layout:     post
title:      数据库基础的复习笔记
subtitle:   Study Memo of Basic Database
date:       2016-09-10
author:     Nico
header-img: img/post_bg_9.jpg
catalog:      true
tags:
    - database
    - sql
    - postgreSQL
    - python
---

最近有时间就复习了一下被我遗忘在角落的数据库语法。

## BRIEF & SUMMARY

### one sentence brief
- 这门课介绍了sql的基本语法和python中调用sql的方法，采用的数据库是postgreSQL，非常实用，总的来说比较简单。
- 老师做了一个简单的网页，通过网页上发帖链接数据库并保存到数据库中，很有意思。
- 数据库语法和python还是很不一样（在数据库里标点很重要），不同的数据库语法也有细微的差别（比如大小写）。

### course webpage
- udaicity [intro to relational database](https://cn.udacity.com/course/intro-to-relational-databases--ud197)

### content
- sql语法
- postgreSQL在shell中的命令
- python和sql的互动

## DETAILS
### sql语法
#### select 查询

```sql
select * from TABLE;
select count(*) from TABLE;
select column1, column2 from TABLE where column3 = 8;
select T.things, S.staff from T, S where T.target = S.match;
select T.things, count(*) as num from T group by T.thing having num = 1;
```

#### insert 插入数据

```sql
insert into TABLE(column1,column2) values ('nico',23);
```

#### alter 更新 表格／column相关数据

```sql
- 新增column： alter table [tablename] add [columnname] [datatype];
- 更改column名字： alter table [tablename] rename [oldcolumnname] to [newcolumnname];
- 更新column结构： alter table [tablename] [column1] set [newdatatype];
- 删除column: alter table [talbename] drop column [columnname];
- 更新表名字：alter table [oldtablename] rename to [newtablename]
```

#### join 合并

join 分 inner join; left join; right join，一般默认的是inner join，即两个表中都要有的元素才会被保留；

```sql
((A join B) as T join C) ## 比较清晰的三个表join的表达；
A join B
on (A.column1 = B.column2)
as A_B
join C
on A_B.column3 = C.column4
group by C.column5;
```

#### update 更新 表格里面的数据

```sql
update A set column = value where restriction;
eg: update table from POST set content = 'cheese' where content like '%spam%';
% 在sql语法中表示模糊识别。
```

#### delete 删除

```sql
delete from [table] where [restriction];
eg: delete from POST where content like '%spam%';
```

#### create 创建表

```sql
create table TABLENAME(
column1 type [constraints],
column2 type [constraints],
column3 type [constraints],
column4 type [constraints],
....
);
```

#### drop 删除表/database

```sql
drop table/database name [options];
```

#### 设置主键
单主键

```sql
create table TABLENAME(
column1 text,
column2 serial primary key,
column3 integer,
column4 float,
....
);
```

多主键

```sql
create table TABLENAME(
column1 text,
column2 serial,
column3 integer,
column4 float,
....
primary key (column1,column2),
);
```
#### reference的用法

```sql
create table B(
column1 integer references original TABLE A.column3,
column2 text,
)
```

实用reference以后，tableB 的 column1 只有可能出现 A.column3 中存在的值，如果试图输入其他值会报错

#### 比较复杂的应用例子

```sql
select a.id, b.id, a.building, a.room
from residences as a, residences as b
where a.building = b.building
and a.room = b.room
and a.id < b.id
order by a.building, a.room;
```
```sql
select products.name, products.sku, count(*) as num
from products join sales
on products.sku = sales.sku
group by products.sku;
```

### postgreSQL在shell中的命令
文档见同目录下的《Tournament Results: Getting Started》

- psql: shell中打开psql数据库；
- \c [somedatabasename]: 链接数据库;
- \conninfo: 列出当前数据库和连接的信息;
- \i [somecode.sql]: 执行sql文件；
- \q: 退出数据库；
- \d [sometablename]: 对table中的列做描述；
- \l: 列出所有数据库；
- \dt: 罗列当前数据库中的所有表;
- \?: 帮助命令；
- \h [drop]： 查询某个sql语法的作用，显示drop的帮助文档；
- \e: 打开文本编辑器；

*其他psql用户管理方面可查看文章：http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html*
*psql官方文档：https://www.postgresql.org/docs/*

### python和sql的互动
链接psql数据库用到psycopg2包

```python
import psycopg2 as psy
```

链接sqlite数据库的包是sqlite3:

```python
import sqlite3
```

前面两个包的写法是一样的：

```python
DB = psy.connect("dbname=forum") ## 链接数据库,sqlite3的话改成 sqlite3.connect
c = DB.cursor() ## 创建执行链接保存到c
query = 'select content,time from posts order by time desc;' ## some sql语句
c.execute(query) ## 执行sql语句
DB.commit() ## commit 如果insert了什么数据的话
result = c.fetchall() ## 调取输出结果
DB.close() ## 和数据库断开链接
```

## RELATED PROJECT & CODE
- project github link: https://github.com/Nicozheng/fullstack-nanodegree-vm.git
- report link: None

## INSPIRATIONS
sql可以用来处理一些常规的规整数据，查询数据的速度比较快，维护起来也比较简单；可以用来做动态网页，储存一些简单的用户数据。
