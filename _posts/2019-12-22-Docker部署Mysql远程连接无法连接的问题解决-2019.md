---
layout:     post                        # 使用的布局（不需要改）
title:      Docker部署Mysql远程连接无法连接的问题解决               # 标题
subtitle:        # 副标题
date:       2019-12-22                 # 时间
author:     AhogeK                      # 作者
header-img: https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/docker-drupal.jpg     # 这篇文章标题背景图片
catalog: true                           # 是否归档
tags:                                   # 标签
    - Docker
    - MySql
---
这边参考了 [这篇文章](https://blog.csdn.net/BingZhongDeHuoYan/article/details/79412914) 可以成功创建一个 MySql 容器
*这边说几点部署上的问题。首先，文章中的部署是直接从Docker官方库里 pull 下来的MySql,所以如果使用阿里云的话会发现下载异常慢，但如果使用的是非国内的云服务器可以很快的下载*

这里再提一点：

**在生成容器操作中，会看到使用了 ``MYSQL_ROOT_PASSWORD=123456`` 这边不推荐直接复制执行，建议更改下密码，不然当你进入容器执行 ``mysql -uroot -p`` 输入正确123456却会发现无法登入**

但这不是这篇文章主要要解决的问题，这篇文章主要要解决的是 ``is not allowed to connect to this MySQL server`` 以及 ``Access Denied for User 'root'@'你尝试登入的远程IP' (using password: YES)``

关于这两个问题，网上也是有很多解答方案的，这里就说下我自己个人使用的解决方案。

我的做法就是一次解决两个问题

``docker exec -it mysql bash``

这样我们就可以进入mysql的容器，进入容器后，进行登录mysql的操作

我们可以 ``use mysql`` 来切换至 mysql的数据库

首先可以 ``select user, host from user;``

会看到有个 root 用户，且 host 是 'localhost'。网上有很多方案，就是说直接update这个数据库，再 GRANT 这个 root 账号，但事实上，我还是一直报 ``.... using password: YES`` 的错误。而我后来先将这个 root 用户从 user表中删除，然后执行

```mysql
CREATE USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'Current-Root-Password';
FLUSH PRIVILEGES;
```

第一条命令就是创建一个root账号，而必须执行第二条命令第一条才算是生效。

然后此时

``GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;``

同样也需要执行 ``FLUSH PRIVILEGES;``

这里如果使用阿里云需要注意*阿里云是否将这个mysql容器使用的端口开放了权限*

这样再尝试在外网连接就可以成功进入mysql的服务器

-----------------
参考网站：

[How to grant all privileges to root user in MySQL 8.0](https://stackoverflow.com/questions/50177216/how-to-grant-all-privileges-to-root-user-in-mysql-8-0)

[远程连接mysql时，提示“is not allowed to connect to this MySQL server”的解决方法](https://blog.csdn.net/nyist327/article/details/45074559)

[Access Denied for User 'root'@'localhost' (using password: YES) - No Privileges?](https://stackoverflow.com/questions/17975120/access-denied-for-user-rootlocalhost-using-password-yes-no-privileges)