---
layout:     post                        # 使用的布局（不需要改）
title:      数据库设计实战学习笔记(二)前导知识              # 标题
subtitle:   新零售数据结构设计  # 副标题
date:       2020-04-27                  # 时间
author:     AhogeK                      # 作者
header-img:  https://tr3.cbsistatic.com/hub/i/r/2016/08/02/ffb48ac0-b355-4aec-b814-04c79e1e1bfd/resize/1200x/292c4adbf288356b843876804b244d69/mysqlhero.jpg    # 这篇文章标题背景图片
catalog: true                           # 是否归档
tags:                                   # 标签
    - MySQL
    - 慕课学习笔记
---
### 什么是SPU？
>SPU(Standard Product Unit)是商品信息聚合的最小单位，是一组可复用、易检索的标准化信息的集合，该集合描述了一个产品的特性。通俗点讲，属性值、特性相同的商品就可以称为一个SPU。

#### 什么时候会用到SPU？
*例如后台的商品管理，iphone12是一个SPU，与商家、颜色、款式、套餐等无关*

### 什么是SKU
>SKU(stock keeping unit)即库存进出计量的单位， 可以是以件、盒、托盘等为单位。在服装、鞋类商品中使用最多最普遍。 例如纺织品中一个SKU通常表示：规格、颜色、款式。

#### 如何设计品类参数？
![sku](https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/Screenshot%20from%202020-05-01%2017-41-29.png)

$$ 手机------>\left\{
\begin{aligned}
CPU \\
内存 \\
尺寸 \\
电池
\end{aligned}
\right.
$$

![sku2](https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/Screenshot%20from%202020-05-01%2017-51-10.png)

*t_开头数据表 v_开头视图表*

**唯一性约束本身自带索引功能，所以一般情况下加唯一性约束的字段可以不用加索引。但是MySQL的缩影分为HASH和BTREE两种。唯一性约束是BTREE而Index是HASH**

[关于MySQL索引](https://www.runoob.com/mysql/mysql-index.html)

**布尔类型在MySQL里面对应的是tinyint**

在表创建中会有分类表，而分类表与品牌表是多对多的关系（例如索尼既有手机也有游戏机，而游戏机有索尼也有微软还有任天堂），既然是多对多就会有关联表，就是由两个字段组成的复合主键表。

**使用中文分词技术，不会对字段添加索引**

**在MySQL中存储浮点类型数据使用*DECIMAL*类型存储**

#### 库存能定义到商品表吗？
* 如果新零售系统没有分店，那么可以把库存定义到商品表
  * ![stock](https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/Screenshot%20from%202020-05-03%2019-57-25.png)

零售店跟仓库是多对多，而零售店跟商品是多对多（通过关联表关联），而商品跟仓库也是多对多（同样通过关联表关联）

*密码使用AES加密，即可以加密也可以解密，解密可以用于密码找回，解密密码并加密邮件发送至客户*

```sql
# AES 加密 HEX函数可解决乱码(即将二进制数据转换成十六进制)
SELECT HEX(AES_ENCRYPT("HelloWorld", "new retail"));

# AES 解密 UNHEX函数用于将十六进制转换为二进制
SELECT AES_DECRYPT(UNHEX("799531CA0BEB4078163F10BD4D081DDC"), "new retail");

INSERT INTO t_customer(username, `password`, wechat, tel)
VALUES("JACK123", HEX(AES_ENCRYPT("abc123456","jack12")), "jack123", "15912345678");
```

#### 购物券的使用规则
* 购物券有使用期限，而且一个订单只可以用一张购物券
* 购物券与客户记录关联
*用户可以领取多张购物券，客户关联购物券表不能用复合主键*

#### 订单需要两张表存储（订单表/订单明细表）
* 一张订单中可以包含多个商品记录，可不可以用JSON存储这些商品信息？
* JSON字段合适存储数据，不适合检索数据

*订单表会有订单流水号，订单的流水号规则可以自定义*
*一个订单中不允许出现两件相同的商品信息*

#### 新零售系统的进销存属性
* 新零售系统具有进销存属性，所以需要先设计出员工表、用户表和角色表
员工表与发货表多对一/员工表与用户表一对一/用户表与角色表一对一

![](https://ahogek-oss.oss-cn-hangzhou.aliyuncs.com/blog-img/Screenshot%20from%202020-05-05%2023-57-57.png)

```sql
CREATE TABLE `t_spec_group` (
  `id` int unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
  `spg_id` int unsigned NOT NULL COMMENT '品类编号',
  `name` varchar(200) NOT NULL COMMENT '品类名称',
  PRIMARY KEY (`id`),
  UNIQUE KEY `unq_spg_id` (`spg_id`),
  UNIQUE KEY `unq_name` (`name`),
  KEY `idx_spg_id` (`spg_id`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8 COMMENT='品类表';

CREATE TABLE t_spec_param(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	spg_id INT UNSIGNED NOT NULL COMMENT '品类编号',
	spp_id INT UNSIGNED NOT NULL COMMENT '参数编号',
	`name` VARCHAR(200) NOT NULL COMMENT '参数名称',
	`numeric` BOOLEAN NOT NULL COMMENT '是否为数字参数',
	unit VARCHAR(200) COMMENT '单位(量词)',
	generic BOOLEAN NOT NULL COMMENT '是否为通用参数',
	searching BOOLEAN NOT NULL COMMENT '是否用于通用搜索',
	segements VARCHAR(500) COMMENT '参数值',
	INDEX idx_spg_id(spg_id),
	INDEX idx_spp_id(spp_id)
) COMMENT='参数表';

CREATE TABLE t_brand(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	`name` VARCHAR(200) NOT NULL COMMENT '名称',
	image VARCHAR(500) NOT NULL COMMENT '图片地址',
	letter CHAR(1) NOT NULL COMMENT '品牌首字母',
	UNIQUE unq_name(`name`),
	INDEX idx_letter(letter)
) COMMENT='品牌表';

CREATE TABLE t_category(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	`name` VARCHAR(200) NOT NULL COMMENT '分类名称',
	parent_id INT UNSIGNED COMMENT '上级分类ID',
	if_parent BOOLEAN NOT NULL COMMENT '是否含有下级分类',
	sort INT UNSIGNED NOT NULL COMMENT '排名指数',
	INDEX idx_parent_id(parent_id),
	INDEX idx_sort(sort)
) COMMENT='商品分类表';

CREATE TABLE t_category_brand(
	category_id INT UNSIGNED COMMENT '分类ID',
	brand_id INT UNSIGNED COMMENT '品牌ID',
	PRIMARY KEY(category_id, brand_id)
) COMMENT='分类与品牌关联表';

CREATE TABLE t_spu(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	title VARCHAR(200) NOT NULL COMMENT '标题',
	sub_title VARCHAR(200) COMMENT '副标题',
	category_id INT UNSIGNED NOT NULL COMMENT '分类ID',
	brand_id INT UNSIGNED COMMENT '品牌ID',
	spg_id INT UNSIGNED NOT NULL COMMENT '品类ID',
	saleable BOOLEAN NOT NULL COMMENT '是否上架',
	valid BOOLEAN NOT NULL COMMENT '是否有效',
	create_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '添加时间',
	last_update_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '最后修改时间',
	INDEX idx_brand_id(brand_id),
	INDEX idx_category_id(category_id),
	INDEX idx_spg_id(spg_id),
	INDEX idx_saleable(saleable),
	INDEX idx_valid(valid)
) COMMENT='产品表';

CREATE TABLE t_sku(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	spu_id INT UNSIGNED NOT NULL COMMENT '产品ID',
	title VARCHAR(200) NOT NULL COMMENT '商品标题',
	images JSON COMMENT '商品图片',
	price DECIMAL(20,2) UNSIGNED NOT NULL COMMENT '价格',
	param JSON NOT NULL COMMENT '参数',
	saleable BOOLEAN NOT NULL COMMENT '是否上架',
	valid BOOLEAN NOT NULL COMMENT '是否有效',
	create_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '添加时间',
	last_update_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '最后修改时间',
	INDEX idx_spu_id(spu_id),
	INDEX idx_saleable(saleable),
	INDEX idx_valid(valid)
) COMMENT='商品表';

CREATE TABLE t_province(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	province VARCHAR(200) NOT NULL COMMENT '省份',
	UNIQUE unq_province(province)
) COMMENT='省份表';

-- ----------------------------
-- Records of t_province
-- ----------------------------
INSERT INTO `t_province` VALUES (1, '北京');
INSERT INTO `t_province` VALUES (2, '上海');
INSERT INTO `t_province` VALUES (3, '天津');
INSERT INTO `t_province` VALUES (4, '重庆');
INSERT INTO `t_province` VALUES (5, '辽宁');
INSERT INTO `t_province` VALUES (6, '吉林');
INSERT INTO `t_province` VALUES (7, '黑龙江');
INSERT INTO `t_province` VALUES (8, '山东');
INSERT INTO `t_province` VALUES (9, '江苏');
INSERT INTO `t_province` VALUES (10, '浙江');
INSERT INTO `t_province` VALUES (11, '安徽');
INSERT INTO `t_province` VALUES (12, '福建');
INSERT INTO `t_province` VALUES (13, '江西');
INSERT INTO `t_province` VALUES (14, '广东');
INSERT INTO `t_province` VALUES (15, '广西');
INSERT INTO `t_province` VALUES (16, '海南');
INSERT INTO `t_province` VALUES (17, '河南');
INSERT INTO `t_province` VALUES (18, '湖南');
INSERT INTO `t_province` VALUES (19, '湖北');
INSERT INTO `t_province` VALUES (20, '河北');
INSERT INTO `t_province` VALUES (21, '山西');
INSERT INTO `t_province` VALUES (22, '内蒙古');
INSERT INTO `t_province` VALUES (23, '宁夏');
INSERT INTO `t_province` VALUES (24, '青海');
INSERT INTO `t_province` VALUES (25, '陕西');
INSERT INTO `t_province` VALUES (26, '甘肃');
INSERT INTO `t_province` VALUES (27, '新疆');
INSERT INTO `t_province` VALUES (28, '四川');
INSERT INTO `t_province` VALUES (29, '贵州');
INSERT INTO `t_province` VALUES (30, '云南');
INSERT INTO `t_province` VALUES (31, '西藏');
INSERT INTO `t_province` VALUES (32, '香港');
INSERT INTO `t_province` VALUES (33, '澳门');
INSERT INTO `t_province` VALUES (34, '台湾');

CREATE TABLE t_city(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	city VARCHAR(200) NOT NULL COMMENT '城市',
	province_id INT UNSIGNED NOT NULL COMMENT '省份ID'
) COMMENT='城市表';

-- ----------------------------
-- Records of t_city
-- ----------------------------
INSERT INTO `t_city` VALUES (1, '沈阳', 5);
INSERT INTO `t_city` VALUES (2, '大连', 5);
INSERT INTO `t_city` VALUES (3, '鞍山', 5);
INSERT INTO `t_city` VALUES (4, '长春', 6);
INSERT INTO `t_city` VALUES (5, '吉林', 6);
INSERT INTO `t_city` VALUES (6, '哈尔滨', 7);
INSERT INTO `t_city` VALUES (7, '齐齐哈尔', 7);
INSERT INTO `t_city` VALUES (8, '牡丹江', 7);

CREATE TABLE t_warehouse(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	city_id INT UNSIGNED NOT NULL COMMENT '城市ID',
	address VARCHAR(200) NOT NULL COMMENT '地址',
	tel VARCHAR(20) NOT NULL COMMENT '电话',
	INDEX idx_city_id(city_id)
) COMMENT='仓库表';

-- ----------------------------
-- Records of t_warehouse
-- ----------------------------
INSERT INTO `t_warehouse` VALUES (1, 1, '辽宁省沈阳市沈河区青年大街100号', '024-12345678');
INSERT INTO `t_warehouse` VALUES (2, 1, '辽宁省沈阳市皇姑区崇山路41号', '024-22331234');
INSERT INTO `t_warehouse` VALUES (3, 2, '辽宁省大连市西岗区五四路38号', '0411-12345678');
INSERT INTO `t_warehouse` VALUES (4, 2, '辽宁省大连市沙河口区星云街1号', '0411-98213210');

CREATE TABLE t_warehouse_sku(
	warehouse_id INT UNSIGNED COMMENT '仓库ID',
	sku_id INT UNSIGNED COMMENT '商品ID',
	num INT UNSIGNED NOT NULL COMMENT '库存数量',
	unit VARCHAR(20) NOT NULL COMMENT '库存单位',
	PRIMARY KEY (warehouse_id, sku_id)
) COMMENT='仓库商品库存表';

-- ----------------------------
-- Records of t_warehouse_sku
-- ----------------------------
INSERT INTO `t_warehouse_sku` VALUES (1, 1, 20, '部');
INSERT INTO `t_warehouse_sku` VALUES (1, 2, 15, '部');
INSERT INTO `t_warehouse_sku` VALUES (1, 3, 40, '部');
INSERT INTO `t_warehouse_sku` VALUES (1, 4, 0, '部');
INSERT INTO `t_warehouse_sku` VALUES (2, 1, 0, '部');
INSERT INTO `t_warehouse_sku` VALUES (2, 2, 0, '部');
INSERT INTO `t_warehouse_sku` VALUES (2, 3, 5, '部');
INSERT INTO `t_warehouse_sku` VALUES (2, 4, 19, '部');

CREATE TABLE t_shop(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	city_id INT UNSIGNED NOT NULL COMMENT '城市ID',
	address VARCHAR(200) NOT NULL COMMENT '地址',
	tel VARCHAR(20) NOT NULL COMMENT '电话',
	INDEX idx_city_id(city_id)
) COMMENT='零售店表';

CREATE TABLE t_shop_sku(
	shop_id INT UNSIGNED COMMENT '零售店ID',
	sku_id INT UNSIGNED COMMENT '商品ID',
	num INT UNSIGNED NOT NULL COMMENT '库存数量',
	unit VARCHAR(20) NOT NULL COMMENT '库存单位',
	PRIMARY KEY (shop_id, sku_id)
) COMMENT='零售店商品库存表';

CREATE TABLE t_level(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	`level` VARCHAR(200) NOT NULL COMMENT '等级',
	discount DECIMAL(10,2) UNSIGNED NOT NULL COMMENT '折扣'
) COMMENT='会员登记表';

-- ----------------------------
-- Records of t_level
-- ----------------------------
INSERT INTO `t_level` VALUES (1, '铜牌会员', 0.99);
INSERT INTO `t_level` VALUES (2, '银牌会员', 0.98);
INSERT INTO `t_level` VALUES (3, '金牌会员', 0.97);
INSERT INTO `t_level` VALUES (4, '白金会员', 0.95);
INSERT INTO `t_level` VALUES (5, '钻石会员', 0.92);

CREATE TABLE t_customer(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	username  VARCHAR(200) NOT NULL COMMENT '用户名',
	`password` VARCHAR(2000) NOT NULL COMMENT '密码（AES加密）',
	wechat VARCHAR(200) COMMENT '微信号',
	tel CHAR(11) COMMENT '手机号',
	level_id INT UNSIGNED COMMENT '会员等级',
	create_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '添加时间',
	last_update_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '最后修改时间',
	INDEX idx_username(username),
	UNIQUE unq_username(username)
) COMMENT='客户表';

-- ----------------------------
-- Records of t_customer
-- ----------------------------
INSERT INTO `t_customer` VALUES (1, 'scott123', 'BDC0253EF1EFF8B5D6D62F5073972493', NULL, NULL, 1, '2019-04-06 22:50:50', '2019-04-06 22:50:50');
INSERT INTO `t_customer` VALUES (2, 'jack123', 'CBB577666CE2963533369D1AA9D229D5', 'jack123', '15912345678', NULL, '2019-04-06 23:06:50', '2019-04-06 23:06:50');

CREATE TABLE t_customer_address(
 id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
 customer_id INT UNSIGNED NOT NULL COMMENT '客户ID',
 `name` VARCHAR(200) NOT NULL COMMENT '收货人姓名',
 tel CHAR(11) NOT NULL COMMENT '收货人电话',
 address VARCHAR(200) NOT NULL COMMENT '收获地址',
 prime BOOLEAN NOT NULL COMMENT '是否为缺省收货地址',
 INDEX idx_customer_id(customer_id)
) COMMENT='收货地址表';

-- ----------------------------
-- Records of t_customer_address
-- ----------------------------
INSERT INTO `t_customer_address` VALUES (1, 1, '陈浩', '13312345678', '辽宁省大连市高新园区6号9#11-1', 0);
INSERT INTO `t_customer_address` VALUES (2, 1, '李娜', '18912345678', '辽宁省大连市沙河口区星月街17号2#1-3', 0);
INSERT INTO `t_customer_address` VALUES (3, 1, '徐亮', '13723567412', '辽宁省营口市盼盼工业园1-1', 1);

# AES 加密 HEX函数可解决乱码(即将二进制数据转换成十六进制)
SELECT HEX(AES_ENCRYPT("HelloWorld", "new retail"))

# AES 解密 UNHEX函数用于将十六进制转换为二进制
SELECT AES_DECRYPT(UNHEX("799531CA0BEB4078163F10BD4D081DDC"), "new retail");

CREATE TABLE t_voucher(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	deno DECIMAL(10,2) UNSIGNED NOT NULL COMMENT '面值',
	`condition` DECIMAL(10.2) UNSIGNED NOT NULL COMMENT '订单满多少钱可以使用',
	start_date DATE COMMENT '起始日期',
	end_date DATE COMMENT '截至日期',
	max_num INT COMMENT '代金券发放最大数量'
) COMMENT="购物券表";

-- ----------------------------
-- Records of t_voucher
-- ----------------------------
INSERT INTO `t_voucher` VALUES (1, 50.00, 1000.00, '2019-04-25', '2019-05-25', 1000);
INSERT INTO `t_voucher` VALUES (2, 20.00, 500.00, '2019-04-25', '2019-05-25', NULL);

CREATE TABLE t_voucher_customer(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	voucher_id INT UNSIGNED NOT NULL COMMENT '购物券ID',
	customer_id INT UNSIGNED NOT NULL COMMENT '客户ID'
) COMMENT='客户关联购物券数据表';

-- ----------------------------
-- Records of t_voucher_customer
-- ----------------------------
INSERT INTO `t_voucher_customer` VALUES (1, 1, 1);
INSERT INTO `t_voucher_customer` VALUES (2, 1, 1);
INSERT INTO `t_voucher_customer` VALUES (3, 1, 1);
INSERT INTO `t_voucher_customer` VALUES (4, 2, 1);
INSERT INTO `t_voucher_customer` VALUES (5, 2, 1);

CREATE TABLE t_order(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	`code` VARCHAR(200) NOT NULL COMMENT '流水号',
	type TINYINT UNSIGNED NOT NULL COMMENT '订单类型：1实体销售，2网络销售',
	shop_id INT UNSIGNED COMMENT '零售店ID',
	customer_id INT UNSIGNED COMMENT '会员ID',
	amount DECIMAL(20,2) UNSIGNED NOT NULL COMMENT '总金额',
	payment_type TINYINT UNSIGNED NOT NULL COMMENT '支付方式：1借记卡，2信用卡，3微信，4支付宝，5现金',
	`status` TINYINT UNSIGNED NOT NULL COMMENT '状态：1未付款，2已付款，3已发货，4已签收',
	postage DECIMAL(10,2) UNSIGNED COMMENT '邮费',
	weight INT UNSIGNED COMMENT '购物券ID',
	voucher_id INT UNSIGNED COMMENT '购物券ID',
	create_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '创建时间',
	INDEX idx_code(`code`),
	INDEX idx_customer_id(customer_id),
	INDEX idx_status(`status`),
	INDEX idx_create_time(create_time),
	INDEX idx_type(type),
	INDEX idx_shop_id(shop_id),
	UNIQUE qnq_code(`code`)
) COMMENT='订单表';

-- ----------------------------
-- Records of t_order
-- ----------------------------
INSERT INTO `t_order` VALUES (1, 'CX0000000120160522', 1, 3, 1, 5998.00, 5, 2, NULL, NULL, NULL, '2019-04-11 01:07:05', 0);
INSERT INTO `t_order` VALUES (2, 'CX0000000120160523', 2, NULL, 1, 5998.00, 1, 2, 60.00, 530, NULL, '2019-04-11 21:22:37', 0);

CREATE TABLE t_order_detail(
	order_id INT UNSIGNED NOT NULL COMMENT '订单ID',
	sku_id INT UNSIGNED NOT NULL COMMENT '商品ID',
	price DECIMAL(20,2) UNSIGNED NOT NULL COMMENT '原价格',
	actual_price DECIMAL(10,2) UNSIGNED NOT NULL COMMENT '实际购买价',
	num INT UNSIGNED NOT NULL COMMENT '购买数量',
	PRIMARY KEY (order_id, sku_id)
) COMMENT='订单详细表';

-- ----------------------------
-- Records of t_order_detail
-- ----------------------------
INSERT INTO `t_order_detail` VALUES (1, 3, 2999.00, 2999.00, 1);
INSERT INTO `t_order_detail` VALUES (1, 4, 2999.00, 2999.00, 1);
INSERT INTO `t_order_detail` VALUES (2, 3, 2999.00, 2999.00, 2);

CREATE TABLE t_dept(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	dname VARCHAR(20) NOT NULL COMMENT '部门名称',
	UNIQUE unq_dname(dname)
) COMMENT='部门表';

-- ----------------------------
-- Records of t_dept
-- ----------------------------
INSERT INTO `t_dept` VALUES (1, '董事会');
INSERT INTO `t_dept` VALUES (2, '总裁办');
INSERT INTO `t_dept` VALUES (3, '零售部');
INSERT INTO `t_dept` VALUES (4, '网商部');
INSERT INTO `t_dept` VALUES (5, '技术部');
INSERT INTO `t_dept` VALUES (6, '售后部');

CREATE TABLE t_job(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	job VARCHAR(20) NOT NULL COMMENT '职位名称',
	UNIQUE unq_job(job)
) COMMENT='职位表';


-- ----------------------------
-- Records of t_job
-- ----------------------------
INSERT INTO `t_job` VALUES (1, '董事长');
INSERT INTO `t_job` VALUES (2, '总经理');
INSERT INTO `t_job` VALUES (3, '部门经理');
INSERT INTO `t_job` VALUES (4, '主管');
INSERT INTO `t_job` VALUES (5, '店长');
INSERT INTO `t_job` VALUES (6, '售货员');
INSERT INTO `t_job` VALUES (7, '保安');
INSERT INTO `t_job` VALUES (8, '保管员');
INSERT INTO `t_job` VALUES (9, '实习生');

CREATE TABLE t_emp(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	wid VARCHAR(20) NOT NULL COMMENT '工号',
	ename VARCHAR(20) NOT NULL COMMENT '姓名',
	sex CHAR(1) NOT NULL COMMENT '性别',
	married BOOLEAN NOT NULL COMMENT '婚否',
	education TINYINT NOT NULL COMMENT '学历：1大专，2本科，3研究生，4博士，5其他',
	tel CHAR(11) NOT NULL COMMENT '电话',
	email VARCHAR(200) COMMENT '邮箱',
	address VARCHAR(200) COMMENT '住址',
	job_id INT UNSIGNED NOT NULL COMMENT '职务ID',
	dept_id INT UNSIGNED COMMENT '部门ID',
	mgr_id INT UNSIGNED COMMENT '上司ID',
	hiredate DATE NOT NULL COMMENT '入职日期',
	termdate DATE COMMENT '离职日期',
	`status` TINYINT UNSIGNED NOT NULL COMMENT '状态：1在职，2休假，3离职，4死亡',
	INDEX idx_job_id(job_id),
	INDEX idx_dept_id(dept_id),
	INDEX idx_status(`status`),
	INDEX idx_mgr_id(mgr_id),
	INDEX idx_wid(wid),
	UNIQUE unq_wid(wid)
) COMMENT='员工表';

-- ----------------------------
-- Records of t_emp
-- ----------------------------
INSERT INTO `t_emp` VALUES (1, 'S10010E', '李娜', '女', 1, 2, '18912345678', NULL, NULL, 5, 3, NULL, '2018-12-06', NULL, 1);
INSERT INTO `t_emp` VALUES (2, 'S10014A', '刘畅', '女', 1, 2, '13312345678', NULL, NULL, 6, 3, 1, '2019-04-11', NULL, 1);
INSERT INTO `t_emp` VALUES (3, 'TE0023', '陈婷婷', '女', 0, 1, '13322334545', NULL, NULL, 9, 3, NULL, '2019-05-16', NULL, 1);
INSERT INTO `t_emp` VALUES (4, 'TE0024', '徐刚', '男', 0, 1, '13322334545', NULL, NULL, 9, 4, NULL, '2019-05-16', NULL, 1);

CREATE TABLE t_role(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	role VARCHAR(20) NOT NULL COMMENT '角色名称',
	UNIQUE unq_role(role)
) COMMENT='角色表'; 

-- ----------------------------
-- Records of t_role
-- ----------------------------
INSERT INTO `t_role` VALUES (6, '保管员');
INSERT INTO `t_role` VALUES (3, '售货员');
INSERT INTO `t_role` VALUES (5, '客服');
INSERT INTO `t_role` VALUES (2, '管理员');
INSERT INTO `t_role` VALUES (7, '质检员');
INSERT INTO `t_role` VALUES (1, '超级管理员');
INSERT INTO `t_role` VALUES (4, '零售店长');

CREATE TABLE t_user(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	username VARCHAR(200) NOT NULL COMMENT '用户名',
	`password` VARCHAR(2000) NOT NULL COMMENT '密码（AES加密）',
	emp_id INT UNSIGNED NOT NULL COMMENT '员工ID',
	role_id INT UNSIGNED NOT NULL COMMENT '角色ID',
	`status` TINYINT UNSIGNED NOT NULL COMMENT '状态：1可用，2禁用',
	create_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '添加时间',
	last_update_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '最后修改时间',
	UNIQUE unq_username(username),
	INDEX idx_username(username),
	INDEX idx_emp_id(emp_id),
	INDEX idx_role_id(role_id),
	INDEX idx_status(`status`)
) COMMENT='用户表';
	
-- ----------------------------
-- Records of t_user
-- ----------------------------
INSERT INTO `t_user` VALUES (1, 'demo123', 'C55E8E99B7745306F1B30AE2C8C8D54B', 1, 4, 1, '2019-04-11 15:26:33', '2019-04-11 15:26:33');

CREATE TABLE t_delivery(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	order_id INT UNSIGNED NOT NULL COMMENT '订单ID',
	sku JSON NOT NULL COMMENT '商品',
	qa_id INT UNSIGNED NOT NULL COMMENT '质检员ID',
	de_id INT UNSIGNED NOT NULL COMMENT '发货员ID',
	postid VARCHAR(20) NOT NULL COMMENT '快递单号',
	price DECIMAL UNSIGNED NOT NULL COMMENT '快递费',
	ecp TINYINT UNSIGNED NOT NULL COMMENT '快递公司编号',
	address_id INT UNSIGNED NOT NULL COMMENT '收货地址ID',
	warehouse_id INT UNSIGNED NOT NULL COMMENT '仓库ID',
	create_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '添加时间',
	INDEX idx_order_id(order_id),
	INDEX idx_qa_id(qa_id),
	INDEX idx_de_id(de_id),
	INDEX idx_postid(postid),
	INDEX idx_warehouse_id(warehouse_id),
	INDEX idx_address_id(address_id),
	INDEX idx_ecp(ecp)
) COMMENT='快递表';

-- ----------------------------
-- Records of t_delivery
-- ----------------------------
INSERT INTO `t_delivery` VALUES (1, 2, '[3, 3]', 15, 17, '125488611212545', 60, 1, 1, 1, '2019-04-11 21:14:38');

CREATE TABLE t_backstock(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	order_id INT UNSIGNED NOT NULL COMMENT '订单ID',
	sku JSON NOT NULL COMMENT '退货商品',
	reason VARCHAR(200) NOT NULL COMMENT '退货原因',
	qa_id INT UNSIGNED NOT NULL COMMENT '质检员ID',
	payment DECIMAL(10,2) UNSIGNED NOT NULL COMMENT '退款金额',
	payment_type TINYINT UNSIGNED NOT NULL COMMENT '退款方式：1借记卡，2信用卡，3微信，4支付宝，5现金',
	`status` TINYINT UNSIGNED NOT NULL COMMENT '状态：1退货成功，2无法退货',
	create_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '添加时间',
	INDEX idx_order_id(order_id),
	INDEX idx_qa_id(qa_id),
	INDEX idx_status(`status`)
) COMMENT='退货表';

-- ----------------------------
-- Records of t_delivery
-- ----------------------------
INSERT INTO `t_backstock` VALUES (1,2,'[3]','质量问题',15,2999.00,5,1,NOW());

CREATE TABLE t_rating(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '评价',
	order_id INT UNSIGNED NOT NULL COMMENT '订单ID',
	sku_id INT UNSIGNED NOT NULL COMMENT '商品ID',
	img JSON COMMENT '买家晒图',
	rating TINYINT UNSIGNED NOT NULL COMMENT '评分',
	`comment` VARCHAR(200) COMMENT '评论',
	create_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '添加时间',
	INDEX idx_order_id(order_id),
	INDEX idx_sku_id(sku_id),
	INDEX idx_create_time(create_time)
) COMMENT '评价表';

-- ----------------------------
-- Records of t_rating
-- ----------------------------
INSERT INTO `t_rating` VALUES (1, 2, 3, '[\"http://192.168.99.184/1.jpg\"]', 5, '很好用，很漂亮', '2019-04-12 00:17:40');

CREATE TABLE t_supplier(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	`code` VARCHAR(200) NOT NULL COMMENT '供货商编号',
	`name` VARCHAR(200) NOT NULL COMMENT '供货商名称',
	type TINYINT UNSIGNED NOT NULL COMMENT '类型：1厂家，2代理商，3个人',
	link_man VARCHAR(20) NOT NULL COMMENT '联系人',
	tel VARCHAR(20) NOT NULL COMMENT '联系电话',
	address VARCHAR(200) NOT NULL COMMENT '联系地址',
	bank_name VARCHAR(200) COMMENT '开户银行名称',
	bank_account VARCHAR(200) COMMENT '银行账号',
	`status` TINYINT UNSIGNED NOT NULL COMMENT '状态：1可用，2不可用',
	INDEX idx_code(`code`),
	INDEX idx_type(type),
	INDEX idx_status(`status`),
	INDEX unq_code(`code`)
) COMMENT='供货商品表';

-- ----------------------------
-- Records of t_supplier
-- ----------------------------
INSERT INTO `t_supplier` VALUES (1, '2394125', 'A供货商', 1, '李强', '13312345678', '辽宁省大连市高新园区121号', NULL, NULL, 1);

CREATE TABLE t_supplier_sku(
	supplier_id INT UNSIGNED NOT NULL COMMENT '供货商品',
	sku_id INT UNSIGNED NOT NULL COMMENT '商品ID',
	PRIMARY KEY(supplier_id,sku_id)
) COMMENT='供货商关联商品表';

-- ----------------------------
-- Records of t_supplier_sku
-- ----------------------------
INSERT INTO `t_supplier_sku` VALUES (1, 1);
INSERT INTO `t_supplier_sku` VALUES (1, 2);
INSERT INTO `t_supplier_sku` VALUES (1, 3);

CREATE TABLE t_purchase(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	sku_id INT UNSIGNED NOT NULL COMMENT '商品ID',
	num INT UNSIGNED NOT NULL COMMENT '数量',
	warehouse_id INT UNSIGNED NOT NULL COMMENT '仓库ID',
	in_price DECIMAL(10,2) UNSIGNED NOT NULL COMMENT '采购价格',
	out_price DECIMAL(10,2) UNSIGNED COMMENT '建议零售价',
	buyer_id INT UNSIGNED NOT NULL COMMENT '采购员ID',
	`status` TINYINT UNSIGNED NOT NULL COMMENT '状态：1未完成，2已完成',
	create_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '添加时间',
	INDEX idx_sku_id(sku_id),
	INDEX idx_warehouse_id(warehouse_id),
	INDEX idx_buyer_id(buyer_id),
	INDEX idx_status(`status`),
	INDEX idx_create_time(create_time)
) COMMENT='采购表';

-- ----------------------------
-- Records of t_purchase
-- ----------------------------
INSERT INTO `t_purchase` VALUES (1, 1, 50, 1, 3000.00, 3299.00, 20, 2, '2019-04-12 19:16:03');

CREATE TABLE t_productin(
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键',
	storekeeper_id INT UNSIGNED NOT NULL COMMENT '保管员ID',
	amount DECIMAL(15,2) UNSIGNED NOT NULL COMMENT '总金额',
	supplier_id INT UNSIGNED NOT NULL COMMENT '供应商ID',
	payment DECIMAL(15,2) UNSIGNED NOT NULL COMMENT '实付金额',
	payment_type TINYINT UNSIGNED NOT NULL COMMENT '支付方式',
	invoice BOOLEAN NOT NULL COMMENT '是否开票',
	remark VARCHAR(200) COMMENT '备注',
	create_time TIMESTAMP NOT NULL DEFAULT NOW() COMMENT '添加时间',
	INDEX idx_storekeeper_id(storekeeper_id),
	INDEX idx_supplier_id(supplier_id),
	INDEX idx_payment_type(payment_type),
	INDEX idx_create_time(create_time)
) COMMENT='入库信息表';

-- ----------------------------
-- Records of t_productin
-- ----------------------------
INSERT INTO `t_productin` VALUES (1, 42, 150000.00, 1, 150000.00, 1, 1, NULL, '2019-04-12 19:17:10');

CREATE TABLE t_productin_purchase(
	productin_id INT UNSIGNED NOT NULL COMMENT '入库ID',
	purchase_id INT UNSIGNED NOT NULL COMMENT '采购ID',
	PRIMARY KEY (productin_id, purchase_id)
) COMMENT='入库商品表';

-- ----------------------------
-- Records of t_productin_purchase
-- ----------------------------
INSERT INTO `t_productin_purchase` VALUES (1, 1);
```