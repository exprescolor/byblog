---
layout:     post   				    # 使用的布局（不需要改）
title:       	Calculator（原来脚本是这么写的）			# 标题 
#subtitle:   脚本，xss #副标题
date:       2020-03-11 				# 时间
author:     s-seven 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 学习 CTF
---

# Calculator

这道题要求在1.5秒内提交式子的结果，我想不出不用python的方法，只能写脚本计算，代码如下

```python
import re
import requests 
s=requests.Session()
url="http://vps1.blue-whale.me:23331/calculator/"
r = s.get(url)
r.encoding = 'utf-8'   #修改编码

print(r.text)

num = re.findall(re.compile("(\d.*?)="), r.text)[0]  #正则表达式找到算术式 
print ('result:\n\n%s=%d\n' % (num, eval(num)))  #输出算术式计算结果
rs= s.get(url, params ={"answer": eval(num)})  #将结果提交 
print (rs.text)  #输出返回结果
```

这是我第一次使用Python语言/(ㄒoㄒ)/~~

这个代码有几处要注意的地方，

首先，re和requests都是python的库，通过request库我们可以使用get和post提交页面请求，获得页面session等，它是一个HTTP库。re模块是匹配字符串的模块。

一个就是题中提示的服务器要知道获得算式和提交答案的是一个人，所以要获取session，同一个session中发出请求的cookie相同，即保证了同一个人

还有一个就是正则表达式，用到了findall和compile两个函数，(.*?)表示要返回的列表，数字开头，=结尾，先通过re.compile()将正则表达式的字符串形式编译为Pattern实例，然后通过re.findall() 从左到右扫描字符串，并按找到的顺序返回匹配项。 

在源代码中要求我们通过get来提交表单，变量为answer，前一天我卡在了get这里，格式没有写正确

post方法提交表单：s.post(url,date={“key"：value})

get方法提交表单： s.get(url,params={"key"：value})

#re.compile()

re.compile()方法可以将正则字符串编译成正则表达式对象，以便在后面的匹配中复用

`re.compile(pattern[, flags])`	

re.compile()中可以传入忽略换行等匹配模式，这样在search()、findall()方法中就不需要额外传入了。

# re.findall()

re.findall()在字符串中找到正则表达式所匹配的**所有**子串，并返回一个列表；如果没有找到匹配的，则返回空列表。

返回结果是列表类型，需要遍历一下才能依次获取每组内容。

`

```python
findall(patern, string, flags=0)
```



- pattern : 正则中的模式字符串。

- string : 要被查找替换的原始字符串。

- flags : 标志位，用于控制正则表达式的匹配方式，如：是否区分大小写，多行匹配等等。

  因此，re.findall()方法有2种表达方式：

```python
import re
content = 'one1two22three333four4444'
pattern = re.compile(r'\d+')
print('===方法1：===')
result1 = re.findall(pattern, content)
print(result1) 
print('===方法2===')
result2 = pattern.findall(content)
print(result2)
```


